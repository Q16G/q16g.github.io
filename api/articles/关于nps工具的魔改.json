{"title":"关于nps工具的魔改","uid":"badd5d9a02640c51cb699c12c4298740","slug":"关于nps工具的魔改","date":"2023-05-26T07:52:53.000Z","updated":"2023-05-26T08:00:20.600Z","comments":true,"path":"api/articles/关于nps工具的魔改.json","keywords":null,"cover":"https://k.sinaimg.cn/n/sinacn10110/470/w1170h900/20190411/7c33-hvntnkq4891892.jpg/w700d1q75cms.jpg","content":"<h1 id=\"免责声明🧐\"><a href=\"#免责声明🧐\" class=\"headerlink\" title=\"免责声明🧐\"></a>免责声明🧐</h1><p>本工具仅面向 <strong>合法授权</strong> 的企业安全建设行为，如您需要测试本工具的可用性，请自行搭建靶机环境。</p>\n<p>在使用本工具进行检测时，您应确保该行为符合当地的法律法规，并且已经取得了足够的授权。<strong>请勿对非授权目标进行扫描</strong>。</p>\n<p>如您在使用本工具的过程中存在任何非法行为，您需自行承担相应后果，我们将不承担任何法律及连带责任。</p>\n<p>在安装并使用本工具前，<strong>请您务必审慎阅读</strong>、充分理解各条款内容，限制、免责条款或者其他涉及您重大权益的条款可能会以加粗、加下划线等形式提示您重点注意。 除非您已充分阅读、完全理解并接受本协议所有条款，否则，请您不要安装并使用本工具。您的使用行为或者您以其他任何明示或者默示方式表示接受本协议的，即视为您已阅读并同意本协议的约束。</p>\n<h1 id=\"工具来源及其说明\"><a href=\"#工具来源及其说明\" class=\"headerlink\" title=\"工具来源及其说明\"></a>工具来源及其说明</h1><pre class=\"line-numbers language-none\"><code class=\"language-none\">（1）nps通信流量比较稳定，但特征抓的比较死，所以基于原版的nps进行二次开发<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h3><p>为了工具的免杀性及其后期修改，本人不公开源码。 <strong>本人承诺，工具无毒，只能简单进行二开</strong></p>\n<h1 id=\"魔改部分\"><a href=\"#魔改部分\" class=\"headerlink\" title=\"魔改部分\"></a>魔改部分</h1><pre class=\"line-numbers language-none\"><code class=\"language-none\">（1）重写了nps的认证过程，通信过程均进行加密\n（2）重些了npc的部分，预计后续分离config文件进行加载\n（3）进行了nps未授权漏洞的修复，避免了默认配置未授权\n（4）支持config文件从远端进行加载，在传输过程中均实现流量加密<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h1 id=\"免杀情况\"><a href=\"#免杀情况\" class=\"headerlink\" title=\"免杀情况\"></a>免杀情况</h1><p>（这是魔改后的demo上去的，还请各位测试切莫进行☁️测试、沙箱测试、联网测试）</p>\n<h3 id=\"魔改后流量\"><a href=\"#魔改后流量\" class=\"headerlink\" title=\"魔改后流量\"></a>魔改后流量</h3><p>魔改后的工具流量就不进行抓取了，需要的话，大家可以自行进行测试。</p>\n<h3 id=\"某社区☁️沙箱（demo版测试）\"><a href=\"#某社区☁️沙箱（demo版测试）\" class=\"headerlink\" title=\"某社区☁️沙箱（demo版测试）\"></a>某社区☁️沙箱（demo版测试）</h3><p><img src=\"https://q16g-image.oss-cn-beijing.aliyuncs.com/image-20230526155344963.png\" alt=\"image-20230526155344963\"></p>\n<h3 id=\"virustotal\"><a href=\"#virustotal\" class=\"headerlink\" title=\"virustotal\"></a>virustotal</h3><p><img src=\"https://q16g-image.oss-cn-beijing.aliyuncs.com/image-20230526155357072.png\" alt=\"image-20230526155357072\"></p>\n<h3 id=\"windows-defender（静态）\"><a href=\"#windows-defender（静态）\" class=\"headerlink\" title=\"windows defender（静态）\"></a>windows defender（静态）</h3><p><img src=\"https://q16g-image.oss-cn-beijing.aliyuncs.com/image-20230526155408332.png\" alt=\"image-20230526155408332\"></p>\n<h3 id=\"windows-defender（动态）\"><a href=\"#windows-defender（动态）\" class=\"headerlink\" title=\"windows defender（动态）\"></a>windows defender（动态）</h3><p><img src=\"https://q16g-image.oss-cn-beijing.aliyuncs.com/image-20230526155419518.png\" alt=\"image-20230526155419518\"></p>\n<h3 id=\"360、火绒等其他杀软未进行测试\"><a href=\"#360、火绒等其他杀软未进行测试\" class=\"headerlink\" title=\"360、火绒等其他杀软未进行测试\"></a>360、火绒等其他杀软未进行测试</h3><h1 id=\"项目使用\"><a href=\"#项目使用\" class=\"headerlink\" title=\"项目使用\"></a>项目使用</h1><p>未进行测试nps服务端的注册，所以目前主要还是 .&#x2F;nps的方式来运行</p>\n<h2 id=\"服务端使用\"><a href=\"#服务端使用\" class=\"headerlink\" title=\"服务端使用\"></a>服务端使用</h2><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><img src=\"https://q16g-image.oss-cn-beijing.aliyuncs.com/image-20230526155434956.png\" alt=\"image-20230526155434956\"></h2><h2 id=\"客户端使用\"><a href=\"#客户端使用\" class=\"headerlink\" title=\"客户端使用\"></a>客户端使用</h2><h3 id=\"配置文件启动\"><a href=\"#配置文件启动\" class=\"headerlink\" title=\"配置文件启动\"></a>配置文件启动</h3><p>配置文件如下：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">[common]\nserver_addr&#x3D;127.0.0.1:8024\nconn_type&#x3D;tcp\nvkey&#x3D;123456\nauto_reconnection&#x3D;true\nmax_conn&#x3D;1000\nflow_limit&#x3D;1000\nrate_limit&#x3D;1000\nweb_username&#x3D;admin\nweb_password&#x3D;123\ncrypt&#x3D;true\ncompress&#x3D;true\n#pprof_addr&#x3D;0.0.0.0:9999\ndisconnect_timeout&#x3D;60<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://q16g-image.oss-cn-beijing.aliyuncs.com/image-20230526155512992.png\" alt=\"image-20230526155512992\"></p>\n<h3 id=\"命令行启动\"><a href=\"#命令行启动\" class=\"headerlink\" title=\"命令行启动\"></a>命令行启动</h3><p><img src=\"https://q16g-image.oss-cn-beijing.aliyuncs.com/image-20230526155523864.png\" alt=\"image-20230526155523864\"></p>\n<h3 id=\"命令行以远端配置文件启动\"><a href=\"#命令行以远端配置文件启动\" class=\"headerlink\" title=\"命令行以远端配置文件启动\"></a>命令行以远端配置文件启动</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">npc.exe -rconfig ServerConfig地址\neg.\nnpc.exe -rconfig 127.0.0.1:23123<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h1 id=\"项目进度\"><a href=\"#项目进度\" class=\"headerlink\" title=\"项目进度\"></a>项目进度</h1><p>✅ 2023.5.19 重新写了通信认证协议</p>\n<p>✅ 2023.5.20 把连接流量进行混淆，仅仅支持客户端命令行启动，未支持conf文件启动</p>\n<p>✅ 2023.5.21 支持本地config文件加载</p>\n<p>✅ 2023.5.23 支持config文件<strong>仅</strong>从服务端拉取</p>\n<h1 id=\"后续增加\"><a href=\"#后续增加\" class=\"headerlink\" title=\"后续增加\"></a>后续增加</h1><p>（1）<del>实现其他协议流量的魔改</del></p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><pre class=\"line-numbers language-none\"><code class=\"language-none\">https:&#x2F;&#x2F;github.com&#x2F;ehang-io&#x2F;nps<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n","feature":true,"text":"免责声明🧐本工具仅面向 合法授权 的企业安全建设行为，如您需要测试本工具的可用性，请自行搭建靶机环境。 在使用本工具进行检测时，您应确保该行为符合当地的法律法规，并且已经取得了足够的授权。请勿对非授权目标进行扫描。 如您在使用本工具的过程中存在任何非法行为，您需自行承担相应后果，...","link":"","photos":[],"count_time":{"symbolsCount":"1.4k","symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"工具魔改","slug":"工具魔改","count":1,"path":"api/tags/工具魔改.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%85%8D%E8%B4%A3%E5%A3%B0%E6%98%8E%F0%9F%A7%90\"><span class=\"toc-text\">免责声明🧐</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%B7%A5%E5%85%B7%E6%9D%A5%E6%BA%90%E5%8F%8A%E5%85%B6%E8%AF%B4%E6%98%8E\"><span class=\"toc-text\">工具来源及其说明</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%AF%B4%E6%98%8E\"><span class=\"toc-text\">说明</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E9%AD%94%E6%94%B9%E9%83%A8%E5%88%86\"><span class=\"toc-text\">魔改部分</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%85%8D%E6%9D%80%E6%83%85%E5%86%B5\"><span class=\"toc-text\">免杀情况</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%AD%94%E6%94%B9%E5%90%8E%E6%B5%81%E9%87%8F\"><span class=\"toc-text\">魔改后流量</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9F%90%E7%A4%BE%E5%8C%BA%E2%98%81%EF%B8%8F%E6%B2%99%E7%AE%B1%EF%BC%88demo%E7%89%88%E6%B5%8B%E8%AF%95%EF%BC%89\"><span class=\"toc-text\">某社区☁️沙箱（demo版测试）</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#virustotal\"><span class=\"toc-text\">virustotal</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#windows-defender%EF%BC%88%E9%9D%99%E6%80%81%EF%BC%89\"><span class=\"toc-text\">windows defender（静态）</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#windows-defender%EF%BC%88%E5%8A%A8%E6%80%81%EF%BC%89\"><span class=\"toc-text\">windows defender（动态）</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#360%E3%80%81%E7%81%AB%E7%BB%92%E7%AD%89%E5%85%B6%E4%BB%96%E6%9D%80%E8%BD%AF%E6%9C%AA%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95\"><span class=\"toc-text\">360、火绒等其他杀软未进行测试</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E9%A1%B9%E7%9B%AE%E4%BD%BF%E7%94%A8\"><span class=\"toc-text\">项目使用</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%BD%BF%E7%94%A8\"><span class=\"toc-text\">服务端使用</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\"><span class=\"toc-text\"></span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BD%BF%E7%94%A8\"><span class=\"toc-text\">客户端使用</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%90%AF%E5%8A%A8\"><span class=\"toc-text\">配置文件启动</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%90%AF%E5%8A%A8\"><span class=\"toc-text\">命令行启动</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BB%A5%E8%BF%9C%E7%AB%AF%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%90%AF%E5%8A%A8\"><span class=\"toc-text\">命令行以远端配置文件启动</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E9%A1%B9%E7%9B%AE%E8%BF%9B%E5%BA%A6\"><span class=\"toc-text\">项目进度</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%90%8E%E7%BB%AD%E5%A2%9E%E5%8A%A0\"><span class=\"toc-text\">后续增加</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83\"><span class=\"toc-text\">参考</span></a></li></ol>","author":{"name":"Q16G","slug":"blog-author","avatar":"https://www.helloimg.com/images/2023/05/23/oJaeo5.jpg","link":"/","description":"一个潜心学习网络安全的大学生","socials":{"github":"https://github.com/Q16G","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_57222016?spm=1018.2226.3001.5343","juejin":"","customs":{}}},"mapped":true,"prev_post":{},"next_post":{"title":"Golang多线程并发学习","uid":"a52b5fed34208f47aa981d461e5d2476","slug":"Golang多线程并发请求","date":"2023-05-25T12:44:51.000Z","updated":"2023-05-26T08:00:22.252Z","comments":true,"path":"api/articles/Golang多线程并发请求.json","keywords":null,"cover":null,"text":"golang多线程并发问题 在这几天写golang的多线程并发中，遇到了两个问题，第一个是并发个数控制，第二个是当进行高并发http请求的时候，导致连接池爆满而无法进行正常的请求。这里遂做一个记录，顺便对golang的http请求库、正则库做一个详细介绍。 net&#x2F;HT...","link":"","photos":[],"count_time":{"symbolsCount":"3.1k","symbolsTime":"3 mins."},"categories":[],"tags":[{"name":"开发","slug":"开发","count":1,"path":"api/tags/开发.json"}],"author":{"name":"Q16G","slug":"blog-author","avatar":"https://www.helloimg.com/images/2023/05/23/oJaeo5.jpg","link":"/","description":"一个潜心学习网络安全的大学生","socials":{"github":"https://github.com/Q16G","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_57222016?spm=1018.2226.3001.5343","juejin":"","customs":{}}},"feature":true}}